{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"ES Translator","text":"<p>A lazy yet bulletproof machine translation tool for Elasticsearch.</p> <p> </p>"},{"location":"#what-is-es-translator","title":"What is es-translator?","text":"<p>es-translator reads documents from Elasticsearch, translates them using machine translation, and writes the translations back. It's designed for bulk translation of large document collections.</p>"},{"location":"#features","title":"Features","text":"<ul> <li> <p>Two translation engines</p> <ul> <li>Argos: Neural machine translation with ~30 languages</li> <li>Apertium: Rule-based translation with 40+ language pairs</li> </ul> </li> <li> <p>Scalable processing</p> <ul> <li>Parallel workers for multi-core systems</li> <li>Distributed mode with Celery/Redis for multi-server deployments</li> </ul> </li> <li> <p>Elasticsearch integration</p> <ul> <li>Direct read/write with scroll API</li> <li>Query string filtering</li> <li>Incremental translation (skip already-translated docs)</li> </ul> </li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"pipDocker <pre><code>pip install es-translator\n\nes-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language fr \\\n  --target-language en\n</code></pre> <pre><code>docker run -it --network host icij/es-translator \\\n  es-translator \\\n    --url \"http://localhost:9200\" \\\n    --index my-index \\\n    --source-language fr \\\n    --target-language en\n</code></pre>"},{"location":"#documentation","title":"Documentation","text":"<ul> <li> <p> Usage Guide</p> <p>Complete guide to using es-translator: commands, options, and examples.</p> </li> <li> <p> Configuration</p> <p>All CLI options and environment variables.</p> </li> <li> <p> Datashare Integration</p> <p>Using es-translator with ICIJ's Datashare platform.</p> </li> <li> <p> Architecture</p> <p>How es-translator works internally.</p> </li> <li> <p> API Reference</p> <p>Python API documentation for programmatic usage.</p> </li> <li> <p> Contributing</p> <p>How to contribute to es-translator.</p> </li> </ul>"},{"location":"#links","title":"Links","text":"<ul> <li>GitHub Repository</li> <li>PyPI Package</li> <li>Docker Hub</li> </ul>"},{"location":"#license","title":"License","text":"<p>MIT License - See LICENSE for details.</p>"},{"location":"api/","title":"API Reference","text":"<p>Welcome to the API reference for EsTranslator. This section provides detailed information about the classes, methods, and attributes available in the EsTranslator library.</p>"},{"location":"api/#core","title":"Core","text":""},{"location":"api/#es_translator.EsTranslator","title":"es_translator.EsTranslator","text":"<pre><code>EsTranslator(options)\n</code></pre> <p>Orchestrates translation of Elasticsearch documents.</p> <p>Manages the translation workflow including searching for documents, parallel translation using worker pools, and updating translated documents.</p> <p>Attributes:</p> Name Type Description <code>url</code> <p>Elasticsearch URL.</p> <code>index</code> <p>Index name to search and update.</p> <code>source_language</code> <p>Source language code.</p> <code>target_language</code> <p>Target language code.</p> <code>intermediary_language</code> <p>Optional intermediary language for indirect translation.</p> <code>source_field</code> <p>Field name containing source text.</p> <code>target_field</code> <p>Field name to store translated text.</p> <code>query_string</code> <p>Optional Elasticsearch query string.</p> <code>data_dir</code> <p>Directory for storing interpreter data.</p> <code>scan_scroll</code> <p>Scroll timeout for search.</p> <code>dry_run</code> <p>If True, skip saving translated documents.</p> <code>force</code> <p>Force re-translation of already translated documents.</p> <code>pool_size</code> <p>Number of parallel worker processes.</p> <code>pool_timeout</code> <p>Timeout for worker pool operations.</p> <code>throttle</code> <p>Throttle for rate limiting.</p> <code>progressbar</code> <p>Show progress bar during translation.</p> <code>interpreter_name</code> <p>Name of translation interpreter to use.</p> <code>max_content_length</code> <p>Maximum content length to translate (-1 for unlimited).</p> <code>plan</code> <p>If True, queue translations for later execution.</p> <code>interpreter</code> <p>Instantiated interpreter instance.</p> <p>Parameters:</p> Name Type Description Default <code>options</code> <code>dict[str, Any]</code> <p>Dictionary of configuration options.</p> required Source code in <code>es_translator/es_translator.py</code> <pre><code>def __init__(self, options: dict[str, Any]) -&gt; None:\n    \"\"\"Initialize the Elasticsearch translator.\n\n    Args:\n        options: Dictionary of configuration options.\n    \"\"\"\n    self.url = options['url']\n    self.index = options['index']\n    self.source_language = options['source_language']\n    self.target_language = options['target_language']\n    self.intermediary_language = options['intermediary_language']\n    self.source_field = options['source_field']\n    self.target_field = options['target_field']\n    self.query_string = options['query_string']\n    self.data_dir = options['data_dir']\n    self.scan_scroll = options['scan_scroll']\n    self.dry_run = options.get('dry_run', False)\n    self.force = options['force']\n    self.pool_size = options['pool_size']\n    self.pool_timeout = options['pool_timeout']\n    self.throttle = options['throttle']\n    self.progressbar = options.get('progressbar', False)\n    self.interpreter_name = options['interpreter']\n    self.max_content_length = options.get('max_content_length', -1)\n    self.plan = options.get('plan', False)\n    self.device = options.get('device', 'auto')\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.no_progressbar","title":"no_progressbar  <code>property</code>","text":"<pre><code>no_progressbar\n</code></pre> <p>Check if the progressbar option is set to False.</p> <p>Returns:</p> Name Type Description <code>bool</code> <code>bool</code> <p>True if the progressbar option is False, else False.</p>"},{"location":"api/#es_translator.EsTranslator.options","title":"options  <code>property</code>","text":"<pre><code>options\n</code></pre> <p>Get configuration options as a dictionary.</p> <p>Returns:</p> Type Description <code>dict[str, Any]</code> <p>Dictionary containing all configuration options.</p>"},{"location":"api/#es_translator.EsTranslator.search_source","title":"search_source  <code>property</code>","text":"<pre><code>search_source\n</code></pre> <p>Gets the list of fields to use in the search.</p> <p>Returns:</p> Type Description <code>list[str]</code> <p>List[str]: list of fields to use in the search.</p>"},{"location":"api/#es_translator.EsTranslator.stdout_loglevel","title":"stdout_loglevel  <code>property</code>","text":"<pre><code>stdout_loglevel\n</code></pre> <p>Gets the log level of stdout.</p> <p>Returns:</p> Name Type Description <code>int</code> <code>int</code> <p>The log level of stdout.</p>"},{"location":"api/#es_translator.EsTranslator.configure_search","title":"configure_search","text":"<pre><code>configure_search()\n</code></pre> <p>Configures the search object.</p> <p>Returns:</p> Name Type Description <code>Search</code> <code>Search</code> <p>A configured search object.</p> Source code in <code>es_translator/es_translator.py</code> <pre><code>def configure_search(self) -&gt; Search:\n    \"\"\"Configures the search object.\n\n    Returns:\n        Search: A configured search object.\n    \"\"\"\n    search = self.search()\n    search = search.source(self.search_source)\n    search = search.params(scroll=self.scan_scroll, size=self.pool_size)\n    return search\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.create_client","title":"create_client","text":"<pre><code>create_client()\n</code></pre> <p>Create an Elasticsearch client instance.</p> <p>Returns:</p> Type Description <code>Elasticsearch</code> <p>Configured Elasticsearch client.</p> Source code in <code>es_translator/es_translator.py</code> <pre><code>def create_client(self) -&gt; Elasticsearch:\n    \"\"\"Create an Elasticsearch client instance.\n\n    Returns:\n        Configured Elasticsearch client.\n    \"\"\"\n    return Elasticsearch(self.url)\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.create_translated_hit","title":"create_translated_hit","text":"<pre><code>create_translated_hit(hit)\n</code></pre> <p>Create a TranslatedHit wrapper for a document hit.</p> <p>Parameters:</p> Name Type Description Default <code>hit</code> <code>ObjectBase</code> <p>Document hit object.</p> required <p>Returns:</p> Type Description <code>TranslatedHit</code> <p>TranslatedHit instance ready for translation.</p> Source code in <code>es_translator/es_translator.py</code> <pre><code>def create_translated_hit(self, hit: ObjectBase) -&gt; TranslatedHit:\n    \"\"\"Create a TranslatedHit wrapper for a document hit.\n\n    Args:\n        hit: Document hit object.\n\n    Returns:\n        TranslatedHit instance ready for translation.\n    \"\"\"\n    return TranslatedHit(hit, self.source_field, self.target_field, self.force)\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.create_translation_queue","title":"create_translation_queue","text":"<pre><code>create_translation_queue()\n</code></pre> <p>Creates a queue that can translate documents in parallel.</p> <p>Returns:</p> Name Type Description <code>JoinableQueue</code> <code>JoinableQueue</code> <p>A queue for parallel document translation.</p> Source code in <code>es_translator/es_translator.py</code> <pre><code>def create_translation_queue(self) -&gt; JoinableQueue:\n    \"\"\"Creates a queue that can translate documents in parallel.\n\n    Returns:\n        JoinableQueue: A queue for parallel document translation.\n    \"\"\"\n    return JoinableQueue(self.pool_size)\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.find_document","title":"find_document","text":"<pre><code>find_document(params)\n</code></pre> <p>Find a document by ID and routing.</p> <p>Parameters:</p> Name Type Description Default <code>params</code> <code>dict[str, str]</code> <p>Dictionary containing 'index', 'id', and optionally 'routing'.</p> required <p>Returns:</p> Type Description <code>Document</code> <p>The found Document object.</p> Source code in <code>es_translator/es_translator.py</code> <pre><code>def find_document(self, params: dict[str, str]) -&gt; Document:\n    \"\"\"Find a document by ID and routing.\n\n    Args:\n        params: Dictionary containing 'index', 'id', and optionally 'routing'.\n\n    Returns:\n        The found Document object.\n    \"\"\"\n    using = self.create_client()\n    routing = getattr(params, 'routing', params['id'])\n    return Document.get(index=params['index'], id=params['id'], routing=routing, using=using)\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.init_interpreter","title":"init_interpreter","text":"<pre><code>init_interpreter()\n</code></pre> <p>Initializes the interpreter.</p> <p>Returns:</p> Name Type Description <code>Any</code> <code>Any</code> <p>The initialized interpreter.</p> Source code in <code>es_translator/es_translator.py</code> <pre><code>def init_interpreter(self) -&gt; Any:\n    \"\"\"Initializes the interpreter.\n\n    Returns:\n        Any: The initialized interpreter.\n    \"\"\"\n    pack_dir = path.join(self.data_dir, 'packs', self.interpreter_name)\n    interpreters = (\n        Apertium,\n        Argos,\n    )\n    Interpreter = next(i for i in interpreters if i.name.lower() == self.interpreter_name.lower())\n    # Pass device option only to Argos (Apertium doesn't support GPU)\n    if Interpreter == Argos:\n        return Interpreter(\n            self.source_language, self.target_language, self.intermediary_language, pack_dir, self.device\n        )\n    return Interpreter(self.source_language, self.target_language, self.intermediary_language, pack_dir)\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.instantiate_interpreter","title":"instantiate_interpreter","text":"<pre><code>instantiate_interpreter()\n</code></pre> <p>Instantiates the interpreter.</p> <p>Returns:</p> Name Type Description <code>Any</code> <code>Any</code> <p>An instance of the interpreter.</p> Source code in <code>es_translator/es_translator.py</code> <pre><code>def instantiate_interpreter(self) -&gt; Any:\n    \"\"\"Instantiates the interpreter.\n\n    Returns:\n        Any: An instance of the interpreter.\n    \"\"\"\n    if not hasattr(self, 'interpreter'):\n        with self.print_done(f'Instantiating {self.interpreter_name} interpreter'):\n            self.interpreter = self.init_interpreter()\n    return self.interpreter\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.print_done","title":"print_done","text":"<pre><code>print_done(string)\n</code></pre> <p>Print progress message and yield, showing done/error status.</p> <p>Parameters:</p> Name Type Description Default <code>string</code> <code>str</code> <p>The status message to be printed.</p> required <p>Returns:</p> Type Description <code>None</code> <p>Generator for wrapping operations with status output.</p> Source code in <code>es_translator/es_translator.py</code> <pre><code>@contextmanager\ndef print_done(self, string: str) -&gt; Generator[None, None, None]:\n    \"\"\"Print progress message and yield, showing done/error status.\n\n    Args:\n        string: The status message to be printed.\n\n    Returns:\n        Generator for wrapping operations with status output.\n    \"\"\"\n    logger.info(string)\n    if self.stdout_loglevel &gt; 20:\n        string = f'\\r{string}...'\n        self.print_flush(string)\n        try:\n            yield\n            print(f'{string} \\033[92mdone\\033[0m')\n        except (FatalTranslationException, ElasticsearchException, Full) as error:\n            logger.error(error, exc_info=True)\n            print(f'{string} \\033[91merror\\033[0m')\n            sys.exit(1)\n    else:\n        yield\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.print_flush","title":"print_flush","text":"<pre><code>print_flush(string)\n</code></pre> <p>Print and flush a string to stdout.</p> <p>Parameters:</p> Name Type Description Default <code>string</code> <code>str</code> <p>The string to be printed.</p> required Source code in <code>es_translator/es_translator.py</code> <pre><code>def print_flush(self, string: str) -&gt; None:\n    \"\"\"Print and flush a string to stdout.\n\n    Args:\n        string: The string to be printed.\n    \"\"\"\n    sys.stdout.write(f'\\r{string}')\n    sys.stdout.flush()\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.process_document","title":"process_document","text":"<pre><code>process_document(\n    translation_queue,\n    hit,\n    progress,\n    task,\n    shared_fatal_error,\n)\n</code></pre> <p>Processes a document.</p> <p>Parameters:</p> Name Type Description Default <code>translation_queue</code> <code>JoinableQueue</code> <p>A queue for parallel document translation.</p> required <code>hit</code> <code>Any</code> <p>The document to be translated.</p> required <code>index</code> <code>int</code> <p>The index of the document.</p> required <code>progress</code> <code>Progress</code> <p>A progress object.</p> required <code>task</code> <code>Any</code> <p>The current task.</p> required <code>shared_fatal_error</code> <code>Manager</code> <p>A shared manager for fatal errors.</p> required Source code in <code>es_translator/es_translator.py</code> <pre><code>def process_document(\n    self, translation_queue: JoinableQueue, hit: Any, progress: Progress, task: Any, shared_fatal_error: Manager\n) -&gt; None:\n    \"\"\"Processes a document.\n\n    Args:\n        translation_queue (JoinableQueue): A queue for parallel document translation.\n        hit (Any): The document to be translated.\n        index (int): The index of the document.\n        progress (Progress): A progress object.\n        task (Any): The current task.\n        shared_fatal_error (Manager): A shared manager for fatal errors.\n    \"\"\"\n    translation_queue.put((self, hit), True, self.pool_timeout)\n    progress.advance(task)\n    if shared_fatal_error.value:\n        raise FatalTranslationException(shared_fatal_error.value)\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.search","title":"search","text":"<pre><code>search()\n</code></pre> <p>Executes a search query.</p> <p>Returns:</p> Name Type Description <code>Search</code> <code>Search</code> <p>The search result.</p> Source code in <code>es_translator/es_translator.py</code> <pre><code>def search(self) -&gt; Search:\n    \"\"\"Executes a search query.\n\n    Returns:\n        Search: The search result.\n    \"\"\"\n    using = self.create_client()\n    search = Search(index=self.index, using=using)\n    if self.query_string:\n        search = search.query('query_string', query=self.query_string)\n    return search\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.start","title":"start","text":"<pre><code>start()\n</code></pre> <p>Starts or plans the translation process.</p> Source code in <code>es_translator/es_translator.py</code> <pre><code>def start(self) -&gt; None:\n    \"\"\"Starts or plans the translation process.\"\"\"\n    if self.plan:\n        self.start_later()\n    else:\n        self.start_now()\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.start_later","title":"start_later","text":"<pre><code>start_later()\n</code></pre> <p>Queue translation tasks for later execution via Celery.</p> Source code in <code>es_translator/es_translator.py</code> <pre><code>def start_later(self) -&gt; None:\n    \"\"\"Queue translation tasks for later execution via Celery.\"\"\"\n    self.instantiate_interpreter()\n    total = self.search().count()\n    plural = 's' if total != 1 else ''\n    desc = f'Planning translation for {total} document{plural}'\n    with self.print_done(desc):\n        search = self.configure_search()\n        for hit in search.scan():\n            logger.info(f'Planned translation for doc {hit.meta.id}')\n            translate_document_task.delay(self.options, hit.meta.to_dict())\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.start_now","title":"start_now","text":"<pre><code>start_now()\n</code></pre> <p>Start the translation process immediately.</p> Source code in <code>es_translator/es_translator.py</code> <pre><code>def start_now(self) -&gt; None:\n    \"\"\"Start the translation process immediately.\"\"\"\n    self.instantiate_interpreter()\n    total = self.search().count()\n    desc = f'Translating {total} document(s)'\n    with self.print_done(desc):\n        search = self.configure_search()\n        if self.pool_size == 1:\n            # Direct translation without multiprocessing (better for GPU)\n            self.translate_documents_direct(search, total)\n        else:\n            translation_queue = self.create_translation_queue()\n            with self.with_shared_fatal_error() as shared_fatal_error:\n                self.translate_documents_in_pool(search, translation_queue, shared_fatal_error, total)\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.translate_document","title":"translate_document","text":"<pre><code>translate_document(hit)\n</code></pre> <p>Translate a single document.</p> <p>Parameters:</p> Name Type Description Default <code>hit</code> <code>ObjectBase</code> <p>Document hit object to translate.</p> required Source code in <code>es_translator/es_translator.py</code> <pre><code>def translate_document(self, hit: ObjectBase) -&gt; None:\n    \"\"\"Translate a single document.\n\n    Args:\n        hit: Document hit object to translate.\n    \"\"\"\n    self.instantiate_interpreter()\n    # Translate the document\n    logger.info(f'Translating doc {hit.meta.id}')\n    translated_hit = self.create_translated_hit(hit)\n    translated_hit.add_translation(self.interpreter, max_content_length=self.max_content_length)\n    logger.info(f'Translated doc {hit.meta.id}')\n    # Save the translated document if not in dry run mode\n    if not self.dry_run:\n        translated_hit.save(self.create_client())\n        logger.info(f'Saved translation for doc {hit.meta.id}')\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.translate_documents_direct","title":"translate_documents_direct","text":"<pre><code>translate_documents_direct(search, total)\n</code></pre> <p>Translate documents directly without multiprocessing.</p> <p>Used when pool_size=1 for simpler execution and better GPU compatibility.</p> <p>Parameters:</p> Name Type Description Default <code>search</code> <code>Search</code> <p>A search object.</p> required <code>total</code> <code>int</code> <p>The total number of documents.</p> required Source code in <code>es_translator/es_translator.py</code> <pre><code>def translate_documents_direct(self, search: Search, total: int) -&gt; None:\n    \"\"\"Translate documents directly without multiprocessing.\n\n    Used when pool_size=1 for simpler execution and better GPU compatibility.\n\n    Args:\n        search: A search object.\n        total: The total number of documents.\n    \"\"\"\n    from time import sleep\n\n    with Progress(disable=self.no_progressbar, transient=True) as progress:\n        plural = 's' if total != 1 else ''\n        task = progress.add_task(f'Translating {total} document{plural}', total=total)\n        for hit in search.scan():\n            try:\n                self.translate_document(hit)\n                sleep(self.throttle / 1000)\n            except ElasticsearchException as error:\n                logger.error(f'An error occurred when saving doc {hit.meta.id}')\n                logger.error(error)\n                raise FatalTranslationException(error)\n            except Exception as error:\n                logger.warning(f'Unable to translate doc {hit.meta.id}')\n                logger.warning(error)\n            finally:\n                progress.advance(task)\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.translate_documents_in_pool","title":"translate_documents_in_pool","text":"<pre><code>translate_documents_in_pool(\n    search, translation_queue, shared_fatal_error, total\n)\n</code></pre> <p>Translates documents using multiprocessing pool.</p> <p>Parameters:</p> Name Type Description Default <code>search</code> <code>Search</code> <p>A search object.</p> required <code>translation_queue</code> <code>JoinableQueue</code> <p>A queue for parallel document translation.</p> required <code>shared_fatal_error</code> <code>Manager</code> <p>A shared manager for fatal errors.</p> required <code>total</code> <code>int</code> <p>The total number of documents.</p> required Source code in <code>es_translator/es_translator.py</code> <pre><code>def translate_documents_in_pool(\n    self, search: Search, translation_queue: JoinableQueue, shared_fatal_error: Manager, total: int\n) -&gt; None:\n    \"\"\"Translates documents using multiprocessing pool.\n\n    Args:\n        search (Search): A search object.\n        translation_queue (JoinableQueue): A queue for parallel document translation.\n        shared_fatal_error (Manager): A shared manager for fatal errors.\n        total (int): The total number of documents.\n    \"\"\"\n    with (\n        Pool(self.pool_size, translation_worker, (translation_queue, shared_fatal_error)),\n        Progress(disable=self.no_progressbar, transient=True) as progress,\n    ):\n        plural = 's' if total != 1 else ''\n        task = progress.add_task(f'Translating {total} document{plural}', total=total)\n        for hit in search.scan():\n            self.process_document(translation_queue, hit, progress, task, shared_fatal_error)\n        translation_queue.join()\n</code></pre>"},{"location":"api/#es_translator.EsTranslator.with_shared_fatal_error","title":"with_shared_fatal_error","text":"<pre><code>with_shared_fatal_error()\n</code></pre> <p>Creates a context manager for managing shared fatal errors.</p> <p>Returns:</p> Type Description <code>None</code> <p>Generator yielding a shared manager value.</p> Source code in <code>es_translator/es_translator.py</code> <pre><code>@contextmanager\ndef with_shared_fatal_error(self) -&gt; Generator[Any, None, None]:\n    \"\"\"Creates a context manager for managing shared fatal errors.\n\n    Returns:\n        Generator yielding a shared manager value.\n    \"\"\"\n    with Manager() as manager:\n        yield manager.Value('b', None)\n</code></pre>"},{"location":"api/#interpreters","title":"Interpreters","text":"<p>EsTranslator supports multiple translation backends (interpreters). Each interpreter has its own strengths and supported language pairs.</p>"},{"location":"api/#argos","title":"Argos","text":"<p>Argos Translate is a neural machine translation library that provides high-quality translations using offline models.</p>"},{"location":"api/#es_translator.interpreters.Argos","title":"es_translator.interpreters.Argos","text":"<pre><code>Argos(\n    source=None,\n    target=None,\n    intermediary=None,\n    pack_dir=None,\n    device=None,\n)\n</code></pre> <p>               Bases: <code>AbstractInterpreter</code></p> <p>Argos translation interpreter using argostranslate.</p> <p>This class handles translation tasks using the Argos neural machine translation engine. Note that Argos does not support intermediary languages or custom package directories.</p> <p>Attributes:</p> Name Type Description <code>name</code> <p>Identifier for this interpreter ('ARGOS').</p> <p>Parameters:</p> Name Type Description Default <code>source</code> <code>Optional[str]</code> <p>Source language code.</p> <code>None</code> <code>target</code> <code>Optional[str]</code> <p>Target language code.</p> <code>None</code> <code>intermediary</code> <code>Optional[str]</code> <p>Intermediary language code (not supported, will warn if provided).</p> <code>None</code> <code>pack_dir</code> <code>Optional[str]</code> <p>Directory for language packs (not supported, will warn if provided).</p> <code>None</code> <code>device</code> <code>Optional[str]</code> <p>Device for translation ('cpu', 'cuda', or 'auto'). Defaults to config value.</p> <code>None</code> <p>Raises:</p> Type Description <code>Exception</code> <p>If the necessary language pair is not available.</p> Source code in <code>es_translator/interpreters/argos/argos.py</code> <pre><code>def __init__(\n    self,\n    source: Optional[str] = None,\n    target: Optional[str] = None,\n    intermediary: Optional[str] = None,\n    pack_dir: Optional[str] = None,\n    device: Optional[str] = None,\n) -&gt; None:\n    \"\"\"Initialize the Argos interpreter.\n\n    Args:\n        source: Source language code.\n        target: Target language code.\n        intermediary: Intermediary language code (not supported, will warn if provided).\n        pack_dir: Directory for language packs (not supported, will warn if provided).\n        device: Device for translation ('cpu', 'cuda', or 'auto'). Defaults to config value.\n\n    Raises:\n        Exception: If the necessary language pair is not available.\n    \"\"\"\n    super().__init__(source, target)\n    # Configure device BEFORE any argostranslate imports\n    self._device_preference = device or DEFAULT_DEVICE\n    self._device_configured = False\n    # Raise an exception if an intermediary language is provided\n    if intermediary is not None:\n        logger.warning('Argos interpreter does not support intermediary language')\n    if pack_dir is not None:\n        logger.warning('Argos interpreter does not support custom pack directory')\n    # Check pair availability - this will trigger argostranslate import\n    # so we configure device first\n    self._ensure_device_configured()\n    if not self.is_pair_available and self.has_pair:\n        try:\n            self.download_necessary_languages()\n        except ArgosPairNotAvailable:\n            raise Exception(f'The pair {self.pair} is not available')\n    else:\n        logger.info(f'Existing package(s) found for pair {self.pair}')\n</code></pre>"},{"location":"api/#es_translator.interpreters.Argos.is_pair_available","title":"is_pair_available  <code>property</code>","text":"<pre><code>is_pair_available\n</code></pre> <p>Check if the necessary language pair is available in installed packages.</p> <p>Returns:</p> Type Description <code>bool</code> <p>True if the language pair is available, False otherwise.</p>"},{"location":"api/#es_translator.interpreters.Argos.local_languages","title":"local_languages  <code>property</code>","text":"<pre><code>local_languages\n</code></pre> <p>Get the codes for the installed languages.</p> <p>Returns:</p> Type Description <code>list[str]</code> <p>List of installed language codes. Returns empty list if languages cannot be retrieved.</p>"},{"location":"api/#es_translator.interpreters.Argos.translation","title":"translation  <code>property</code>","text":"<pre><code>translation\n</code></pre> <p>Get Translation object for the source and target languages.</p> <p>Returns:</p> Type Description <code>Any</code> <p>Translation object configured for source to target language.</p> <p>Raises:</p> Type Description <code>IndexError</code> <p>If either the source or target language is not installed.</p>"},{"location":"api/#es_translator.interpreters.Argos.download_and_install_package","title":"download_and_install_package","text":"<pre><code>download_and_install_package(package)\n</code></pre> <p>Download and install a language package.</p> <p>Uses file locking to prevent concurrent downloads of the same package. Skips installation if the package is already installed.</p> <p>Parameters:</p> Name Type Description Default <code>package</code> <code>Any</code> <p>The package to download and install.</p> required <p>Returns:</p> Type Description <code>Optional[Any]</code> <p>Installation result or None if package was already installed.</p> <p>Raises:</p> Type Description <code>ArgosPackageDownloadLockTimeout</code> <p>If lock cannot be acquired within timeout.</p> Source code in <code>es_translator/interpreters/argos/argos.py</code> <pre><code>def download_and_install_package(self, package: Any) -&gt; Optional[Any]:\n    \"\"\"Download and install a language package.\n\n    Uses file locking to prevent concurrent downloads of the same package.\n    Skips installation if the package is already installed.\n\n    Args:\n        package: The package to download and install.\n\n    Returns:\n        Installation result or None if package was already installed.\n\n    Raises:\n        ArgosPackageDownloadLockTimeout: If lock cannot be acquired within timeout.\n    \"\"\"\n    argospackage = _get_argos_package()\n    try:\n        temp_dir = Path(tempfile.gettempdir())\n        lock_path = temp_dir / f'{package.from_code}_{package.to_code}.lock'\n\n        with FileLock(lock_path, timeout=600).acquire(timeout=600):\n            if self.is_package_installed(package):\n                return None\n            download_path = package.download()\n            logger.info(f'Installing Argos package {package}')\n            return argospackage.install_from_path(download_path)\n    except Timeout as exc:\n        raise ArgosPackageDownloadLockTimeout(\n            f'Another instance of the program is downloading the package {package}. Please try again later.'\n        ) from exc\n</code></pre>"},{"location":"api/#es_translator.interpreters.Argos.download_necessary_languages","title":"download_necessary_languages","text":"<pre><code>download_necessary_languages()\n</code></pre> <p>Download necessary language packages if not installed.</p> <p>Steps: 1. Updates the package index. 2. Finds the necessary package. 3. Downloads and installs the package.</p> <p>Raises:</p> Type Description <code>ArgosPairNotAvailable</code> <p>If the necessary language package could not be found.</p> <code>ArgosPackageDownloadLockTimeout</code> <p>If lock cannot be acquired within timeout.</p> Source code in <code>es_translator/interpreters/argos/argos.py</code> <pre><code>def download_necessary_languages(self) -&gt; None:\n    \"\"\"Download necessary language packages if not installed.\n\n    Steps:\n    1. Updates the package index.\n    2. Finds the necessary package.\n    3. Downloads and installs the package.\n\n    Raises:\n        ArgosPairNotAvailable: If the necessary language package could not be found.\n        ArgosPackageDownloadLockTimeout: If lock cannot be acquired within timeout.\n    \"\"\"\n    self.update_package_index()\n    necessary_package = self.find_necessary_package()\n    self.download_and_install_package(necessary_package)\n</code></pre>"},{"location":"api/#es_translator.interpreters.Argos.find_necessary_package","title":"find_necessary_package","text":"<pre><code>find_necessary_package()\n</code></pre> <p>Find the necessary language package.</p> <p>Searches available packages for one matching the source and target languages.</p> <p>Returns:</p> Type Description <code>Any</code> <p>The necessary language package object.</p> <p>Raises:</p> Type Description <code>ArgosPairNotAvailable</code> <p>If the necessary language package could not be found.</p> Source code in <code>es_translator/interpreters/argos/argos.py</code> <pre><code>def find_necessary_package(self) -&gt; Any:\n    \"\"\"Find the necessary language package.\n\n    Searches available packages for one matching the source and target languages.\n\n    Returns:\n        The necessary language package object.\n\n    Raises:\n        ArgosPairNotAvailable: If the necessary language package could not be found.\n    \"\"\"\n    argospackage = _get_argos_package()\n    for package in argospackage.get_available_packages():\n        if package.from_code == self.source_alpha_2 and package.to_code == self.target_alpha_2:\n            return package\n    raise ArgosPairNotAvailable\n</code></pre>"},{"location":"api/#es_translator.interpreters.Argos.is_package_installed","title":"is_package_installed","text":"<pre><code>is_package_installed(package)\n</code></pre> <p>Check if a package is installed.</p> <p>Parameters:</p> Name Type Description Default <code>package</code> <code>Any</code> <p>The package to check.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if the package is installed, False otherwise.</p> Source code in <code>es_translator/interpreters/argos/argos.py</code> <pre><code>def is_package_installed(self, package: Any) -&gt; bool:\n    \"\"\"Check if a package is installed.\n\n    Args:\n        package: The package to check.\n\n    Returns:\n        True if the package is installed, False otherwise.\n    \"\"\"\n    argospackage = _get_argos_package()\n    return package in argospackage.get_installed_packages()\n</code></pre>"},{"location":"api/#es_translator.interpreters.Argos.translate","title":"translate","text":"<pre><code>translate(text_input)\n</code></pre> <p>Translate input text from source language to target language.</p> <p>Parameters:</p> Name Type Description Default <code>text_input</code> <code>str</code> <p>The input text in the source language.</p> required <p>Returns:</p> Type Description <code>str</code> <p>The translated text in the target language.</p> Source code in <code>es_translator/interpreters/argos/argos.py</code> <pre><code>def translate(self, text_input: str) -&gt; str:\n    \"\"\"Translate input text from source language to target language.\n\n    Args:\n        text_input: The input text in the source language.\n\n    Returns:\n        The translated text in the target language.\n    \"\"\"\n    # Always configure device before translation (needed for multiprocessing workers)\n    self._ensure_device_configured()\n    return self.translation.translate(text_input)\n</code></pre>"},{"location":"api/#es_translator.interpreters.Argos.update_package_index","title":"update_package_index","text":"<pre><code>update_package_index()\n</code></pre> <p>Update the Argos package index to fetch latest available packages.</p> Source code in <code>es_translator/interpreters/argos/argos.py</code> <pre><code>def update_package_index(self) -&gt; None:\n    \"\"\"Update the Argos package index to fetch latest available packages.\"\"\"\n    argospackage = _get_argos_package()\n    argospackage.update_package_index()\n</code></pre>"},{"location":"api/#apertium","title":"Apertium","text":"<p>Apertium is a rule-based machine translation platform that supports a wide variety of language pairs, especially for related languages.</p>"},{"location":"api/#es_translator.interpreters.Apertium","title":"es_translator.interpreters.Apertium","text":"<pre><code>Apertium(\n    source=None,\n    target=None,\n    intermediary=None,\n    pack_dir=None,\n)\n</code></pre> <p>               Bases: <code>AbstractInterpreter</code></p> <p>Apertium translation interpreter.</p> <p>Provides translation capabilities using the Apertium translation engine, with support for direct translation and intermediary language pairs.</p> <p>Attributes:</p> Name Type Description <code>name</code> <p>Identifier for this interpreter ('APERTIUM').</p> <code>repository</code> <p>ApertiumRepository instance for package management.</p> <p>Parameters:</p> Name Type Description Default <code>source</code> <code>Optional[str]</code> <p>Source language code.</p> <code>None</code> <code>target</code> <code>Optional[str]</code> <p>Target language code.</p> <code>None</code> <code>intermediary</code> <code>Optional[str]</code> <p>Optional intermediary language for indirect translation.</p> <code>None</code> <code>pack_dir</code> <code>Optional[str]</code> <p>Directory for storing translation packages.</p> <code>None</code> <p>Raises:</p> Type Description <code>Exception</code> <p>If the language pair is not available in the repository.</p> Source code in <code>es_translator/interpreters/apertium/apertium.py</code> <pre><code>def __init__(\n    self,\n    source: Optional[str] = None,\n    target: Optional[str] = None,\n    intermediary: Optional[str] = None,\n    pack_dir: Optional[str] = None,\n) -&gt; None:\n    \"\"\"Initialize the Apertium interpreter.\n\n    Args:\n        source: Source language code.\n        target: Target language code.\n        intermediary: Optional intermediary language for indirect translation.\n        pack_dir: Directory for storing translation packages.\n\n    Raises:\n        Exception: If the language pair is not available in the repository.\n    \"\"\"\n    super().__init__(source, target, intermediary, pack_dir)\n    # A class to download necessary pair package\n    self.repository = ApertiumRepository(self.pack_dir)\n    # Raise an exception if the language pair is unknown\n    # Note: has_pair must be checked first to avoid accessing local_pairs when no pair is set\n    if self.has_pair and not self.is_pair_available:\n        try:\n            self.download_necessary_pairs()\n        except StopIteration:\n            raise Exception('The pair is not available')\n    else:\n        logger.info(f'Existing package(s) found for pair {self.pair}')\n</code></pre>"},{"location":"api/#es_translator.interpreters.Apertium.any_pair_variant_in_packages","title":"any_pair_variant_in_packages  <code>property</code>","text":"<pre><code>any_pair_variant_in_packages\n</code></pre> <p>Check if any variant of the current pair exists in packages.</p> <p>Returns:</p> Type Description <code>bool</code> <p>True if the pair is available in remote repository.</p>"},{"location":"api/#es_translator.interpreters.Apertium.intermediary_pairs","title":"intermediary_pairs  <code>property</code>","text":"<pre><code>intermediary_pairs\n</code></pre> <p>Get intermediary language pairs for indirect translation.</p> <p>Automatically finds an intermediary language if not specified by building a language tree and finding a path from source to target.</p> <p>Returns:</p> Type Description <code>list[str]</code> <p>List of two language pair strings for indirect translation.</p>"},{"location":"api/#es_translator.interpreters.Apertium.intermediary_source_pair","title":"intermediary_source_pair  <code>property</code>","text":"<pre><code>intermediary_source_pair\n</code></pre> <p>Get source-to-intermediary language pair.</p> <p>Returns:</p> Type Description <code>str</code> <p>Language pair string (e.g., 'eng-spa').</p>"},{"location":"api/#es_translator.interpreters.Apertium.intermediary_source_pair_package","title":"intermediary_source_pair_package  <code>property</code>","text":"<pre><code>intermediary_source_pair_package\n</code></pre> <p>Get package name for source-to-intermediary pair.</p> <p>Returns:</p> Type Description <code>Optional[str]</code> <p>Package name string or None if not found.</p>"},{"location":"api/#es_translator.interpreters.Apertium.intermediary_target_pair","title":"intermediary_target_pair  <code>property</code>","text":"<pre><code>intermediary_target_pair\n</code></pre> <p>Get intermediary-to-target language pair.</p> <p>Returns:</p> Type Description <code>str</code> <p>Language pair string (e.g., 'spa-fra').</p>"},{"location":"api/#es_translator.interpreters.Apertium.intermediary_target_pair_package","title":"intermediary_target_pair_package  <code>property</code>","text":"<pre><code>intermediary_target_pair_package\n</code></pre> <p>Get package name for intermediary-to-target pair.</p> <p>Returns:</p> Type Description <code>Optional[str]</code> <p>Package name string or None if not found.</p>"},{"location":"api/#es_translator.interpreters.Apertium.is_pair_available","title":"is_pair_available  <code>property</code>","text":"<pre><code>is_pair_available\n</code></pre> <p>Check if the language pair is available locally.</p> <p>Returns:</p> Type Description <code>bool</code> <p>True if pair is available without intermediary.</p>"},{"location":"api/#es_translator.interpreters.Apertium.local_pairs","title":"local_pairs  <code>property</code>","text":"<pre><code>local_pairs\n</code></pre> <p>Get locally installed language pairs.</p> <p>Returns:</p> Type Description <code>list[str]</code> <p>List of locally available language pair codes.</p>"},{"location":"api/#es_translator.interpreters.Apertium.pair_package","title":"pair_package  <code>property</code>","text":"<pre><code>pair_package\n</code></pre> <p>Get the package name for the current language pair.</p> <p>Returns:</p> Type Description <code>Optional[str]</code> <p>Package name string or None if not found.</p>"},{"location":"api/#es_translator.interpreters.Apertium.pairs_pipeline","title":"pairs_pipeline  <code>property</code>","text":"<pre><code>pairs_pipeline\n</code></pre> <p>Get the translation pipeline (direct or via intermediary).</p> <p>Returns:</p> Type Description <code>list[str]</code> <p>List of language pair codes to process sequentially.</p>"},{"location":"api/#es_translator.interpreters.Apertium.remote_pairs","title":"remote_pairs  <code>cached</code> <code>property</code>","text":"<pre><code>remote_pairs\n</code></pre> <p>Get remotely available language pairs from repository.</p> <p>Returns:</p> Type Description <code>list[str]</code> <p>List of available language pair codes from the repository.</p>"},{"location":"api/#es_translator.interpreters.Apertium.download_intermediary_pairs","title":"download_intermediary_pairs","text":"<pre><code>download_intermediary_pairs()\n</code></pre> <p>Download both intermediary language pairs for indirect translation.</p> Source code in <code>es_translator/interpreters/apertium/apertium.py</code> <pre><code>def download_intermediary_pairs(self) -&gt; None:\n    \"\"\"Download both intermediary language pairs for indirect translation.\"\"\"\n    for pair in self.intermediary_pairs:\n        self.download_pair(pair)\n</code></pre>"},{"location":"api/#es_translator.interpreters.Apertium.download_necessary_pairs","title":"download_necessary_pairs","text":"<pre><code>download_necessary_pairs()\n</code></pre> <p>Download required language pair packages.</p> <p>Downloads either a direct pair or intermediary pairs depending on availability in the repository.</p> Source code in <code>es_translator/interpreters/apertium/apertium.py</code> <pre><code>def download_necessary_pairs(self) -&gt; None:\n    \"\"\"Download required language pair packages.\n\n    Downloads either a direct pair or intermediary pairs depending on\n    availability in the repository.\n    \"\"\"\n    logger.info(f'Downloading necessary package(s) for {self.pair}')\n    if self.any_pair_variant_in_packages:\n        self.download_pair()\n    else:\n        self.download_intermediary_pairs()\n</code></pre>"},{"location":"api/#es_translator.interpreters.Apertium.download_pair","title":"download_pair","text":"<pre><code>download_pair(pair=None)\n</code></pre> <p>Download and install a specific language pair package.</p> <p>Parameters:</p> Name Type Description Default <code>pair</code> <code>Optional[str]</code> <p>Language pair to download. If None, uses current pair.</p> <code>None</code> <p>Returns:</p> Type Description <code>str</code> <p>Path to the installed package directory.</p> Source code in <code>es_translator/interpreters/apertium/apertium.py</code> <pre><code>def download_pair(self, pair: Optional[str] = None) -&gt; str:\n    \"\"\"Download and install a specific language pair package.\n\n    Args:\n        pair: Language pair to download. If None, uses current pair.\n\n    Returns:\n        Path to the installed package directory.\n    \"\"\"\n    pair = self.pair_alpha_3 if pair is None else to_alpha_3_pair(pair)\n    # All commands must be run from the pack dir\n    return self.repository.install_pair_package(pair)\n</code></pre>"},{"location":"api/#es_translator.interpreters.Apertium.first_pairs_path","title":"first_pairs_path","text":"<pre><code>first_pairs_path(leaf, lang)\n</code></pre> <p>Find the first path from a tree leaf to a target language.</p> <p>Parameters:</p> Name Type Description Default <code>leaf</code> <code>dict</code> <p>Tree node dictionary with 'lang' and 'children' keys.</p> required <code>lang</code> <code>str</code> <p>Target language to find path to.</p> required <p>Returns:</p> Type Description <code>list[str]</code> <p>List of language codes forming the path.</p> Source code in <code>es_translator/interpreters/apertium/apertium.py</code> <pre><code>def first_pairs_path(self, leaf: dict, lang: str) -&gt; list[str]:\n    \"\"\"Find the first path from a tree leaf to a target language.\n\n    Args:\n        leaf: Tree node dictionary with 'lang' and 'children' keys.\n        lang: Target language to find path to.\n\n    Returns:\n        List of language codes forming the path.\n    \"\"\"\n    path = []\n    for child_leaf in leaf['children'].values():\n        if self.leaf_has_lang(child_leaf, lang):\n            path.append(child_leaf['lang'])\n            path = path + self.first_pairs_path(child_leaf, lang)\n            break\n    return path\n</code></pre>"},{"location":"api/#es_translator.interpreters.Apertium.lang_tree","title":"lang_tree","text":"<pre><code>lang_tree(lang, pairs, depth=2)\n</code></pre> <p>Build a tree of language connections from available pairs.</p> <p>Parameters:</p> Name Type Description Default <code>lang</code> <code>str</code> <p>Root language for the tree.</p> required <code>pairs</code> <code>list[list[str]]</code> <p>List of language pair lists.</p> required <code>depth</code> <code>int</code> <p>Maximum depth to traverse (default: 2).</p> <code>2</code> <p>Returns:</p> Type Description <code>dict</code> <p>Dictionary tree structure with 'lang' and 'children' keys.</p> Source code in <code>es_translator/interpreters/apertium/apertium.py</code> <pre><code>def lang_tree(self, lang: str, pairs: list[list[str]], depth: int = 2) -&gt; dict:\n    \"\"\"Build a tree of language connections from available pairs.\n\n    Args:\n        lang: Root language for the tree.\n        pairs: List of language pair lists.\n        depth: Maximum depth to traverse (default: 2).\n\n    Returns:\n        Dictionary tree structure with 'lang' and 'children' keys.\n    \"\"\"\n    tree = {'lang': lang, 'children': {}}\n    for pair in pairs:\n        if lang in pair and depth &gt; 0:\n            child_lang = next(item for item in pair if item != lang)\n            tree['children'][child_lang] = self.lang_tree(child_lang, pairs, depth - 1)\n    return tree\n</code></pre>"},{"location":"api/#es_translator.interpreters.Apertium.leaf_has_lang","title":"leaf_has_lang","text":"<pre><code>leaf_has_lang(leaf, lang)\n</code></pre> <p>Check if a tree leaf contains or leads to a target language.</p> <p>Parameters:</p> Name Type Description Default <code>leaf</code> <code>dict</code> <p>Tree node dictionary with 'lang' and 'children' keys.</p> required <code>lang</code> <code>str</code> <p>Target language to search for.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if the language is found in the leaf or its descendants.</p> Source code in <code>es_translator/interpreters/apertium/apertium.py</code> <pre><code>def leaf_has_lang(self, leaf: dict, lang: str) -&gt; bool:\n    \"\"\"Check if a tree leaf contains or leads to a target language.\n\n    Args:\n        leaf: Tree node dictionary with 'lang' and 'children' keys.\n        lang: Target language to search for.\n\n    Returns:\n        True if the language is found in the leaf or its descendants.\n    \"\"\"\n    children = leaf['children'].values()\n    return lang in leaf['children'] or any(self.leaf_has_lang(child_leaf, lang) for child_leaf in children)\n</code></pre>"},{"location":"api/#es_translator.interpreters.Apertium.pair_to_pair_package","title":"pair_to_pair_package","text":"<pre><code>pair_to_pair_package(pair)\n</code></pre> <p>Convert language pair to package name.</p> <p>Checks both the pair and its reverse for availability in remote packages.</p> <p>Parameters:</p> Name Type Description Default <code>pair</code> <code>str</code> <p>Language pair string (e.g., 'en-es').</p> required <p>Returns:</p> Type Description <code>Optional[str]</code> <p>Package name if found, None otherwise.</p> Source code in <code>es_translator/interpreters/apertium/apertium.py</code> <pre><code>def pair_to_pair_package(self, pair: str) -&gt; Optional[str]:\n    \"\"\"Convert language pair to package name.\n\n    Checks both the pair and its reverse for availability in remote packages.\n\n    Args:\n        pair: Language pair string (e.g., 'en-es').\n\n    Returns:\n        Package name if found, None otherwise.\n    \"\"\"\n    pair_inversed = '-'.join(pair.split('-')[::-1])\n    combinations = [to_alpha_3_pair(pair), to_alpha_3_pair(pair_inversed)]\n    try:\n        return next(p for p in self.remote_pairs if p in combinations)\n    except StopIteration:\n        return None\n</code></pre>"},{"location":"api/#es_translator.interpreters.Apertium.translate","title":"translate","text":"<pre><code>translate(input)\n</code></pre> <p>Translate text through the translation pipeline.</p> <p>If using an intermediary language, translates through multiple pairs.</p> <p>Parameters:</p> Name Type Description Default <code>input</code> <code>str</code> <p>Text to translate.</p> required <p>Returns:</p> Type Description <code>str</code> <p>Translated text string.</p> Source code in <code>es_translator/interpreters/apertium/apertium.py</code> <pre><code>def translate(self, input: str) -&gt; str:\n    \"\"\"Translate text through the translation pipeline.\n\n    If using an intermediary language, translates through multiple pairs.\n\n    Args:\n        input: Text to translate.\n\n    Returns:\n        Translated text string.\n    \"\"\"\n    for pair in self.pairs_pipeline:\n        # Create a sub-process which can receive an input\n        input = self.translate_with_apertium(input, pair)\n    return input\n</code></pre>"},{"location":"api/#es_translator.interpreters.Apertium.translate_with_apertium","title":"translate_with_apertium","text":"<pre><code>translate_with_apertium(input, pair)\n</code></pre> <p>Translate text using Apertium for a specific language pair.</p> <p>Parameters:</p> Name Type Description Default <code>input</code> <code>str</code> <p>Text to translate.</p> required <code>pair</code> <code>str</code> <p>Language pair code (e.g., 'eng-spa').</p> required <p>Returns:</p> Type Description <code>str</code> <p>Translated text string.</p> <p>Raises:</p> Type Description <code>Exception</code> <p>If translation fails.</p> Source code in <code>es_translator/interpreters/apertium/apertium.py</code> <pre><code>def translate_with_apertium(self, input: str, pair: str) -&gt; str:\n    \"\"\"Translate text using Apertium for a specific language pair.\n\n    Args:\n        input: Text to translate.\n        pair: Language pair code (e.g., 'eng-spa').\n\n    Returns:\n        Translated text string.\n\n    Raises:\n        Exception: If translation fails.\n    \"\"\"\n    apertium = _get_apertium()\n    try:\n        # Works with a temporary file as buffer (opened in text mode)\n        with NamedTemporaryFile(mode='w+t') as temp_input_file:\n            temp_input_file.writelines(input)\n            temp_input_file.seek(0)\n            input_translated = apertium('-ud', self.pack_dir, pair, temp_input_file.name)\n    except ErrorReturnCode:\n        raise Exception('Unable to translate this string.')\n    return str(input_translated)\n</code></pre>"},{"location":"api/#repository-management","title":"Repository Management","text":""},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository","title":"es_translator.interpreters.apertium.repository.ApertiumRepository","text":"<pre><code>ApertiumRepository(cache_dir=None, arch=None)\n</code></pre> <p>Manages Apertium package repository operations.</p> <p>Handles downloading, extracting, and installing Apertium translation pairs from the official repository.</p> <p>Attributes:</p> Name Type Description <code>cache_dir</code> <p>Directory path for caching downloaded packages.</p> <code>arch</code> <p>System architecture ('amd64', 'i386', etc.).</p> <p>Parameters:</p> Name Type Description Default <code>cache_dir</code> <code>Optional[str]</code> <p>Directory for caching downloaded packages. Defaults to None.</p> <code>None</code> <code>arch</code> <code>Optional[str]</code> <p>Architecture string ('amd64', 'i386'). If None, auto-detect.</p> <code>None</code> Source code in <code>es_translator/interpreters/apertium/repository.py</code> <pre><code>def __init__(self, cache_dir: Optional[str] = None, arch: Optional[str] = None):\n    \"\"\"Initialize the Apertium repository handler.\n\n    Args:\n        cache_dir: Directory for caching downloaded packages. Defaults to None.\n        arch: Architecture string ('amd64', 'i386'). If None, auto-detect.\n    \"\"\"\n    self.cache_dir = abspath(cache_dir) if cache_dir else abspath('.')\n    self.arch = arch\n</code></pre>"},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository.control_file_content","title":"control_file_content  <code>cached</code> <code>property</code>","text":"<pre><code>control_file_content\n</code></pre> <p>Fetch and cache the Packages control file content.</p> <p>Returns:</p> Type Description <code>str</code> <p>Decoded UTF-8 content of the Packages file.</p> <p>Raises:</p> Type Description <code>URLError</code> <p>If the URL cannot be accessed.</p> <code>HTTPError</code> <p>If HTTP request fails.</p>"},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository.packages","title":"packages  <code>cached</code> <code>property</code>","text":"<pre><code>packages\n</code></pre> <p>Parse and cache the list of available packages.</p> <p>Returns:</p> Type Description <code>list[dict]</code> <p>List of package metadata dictionaries.</p>"},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository.packages_file_url","title":"packages_file_url  <code>property</code>","text":"<pre><code>packages_file_url\n</code></pre> <p>Get the Packages file URL for the configured architecture.</p>"},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository.pair_packages","title":"pair_packages  <code>cached</code> <code>property</code>","text":"<pre><code>pair_packages\n</code></pre> <p>Get filtered list of Apertium translation pair packages.</p> <p>Returns:</p> Type Description <code>list[dict]</code> <p>List of package dictionaries that are translation pairs.</p>"},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository.clear_modes","title":"clear_modes","text":"<pre><code>clear_modes()\n</code></pre> <p>Remove all mode files from the cache directory.</p> Source code in <code>es_translator/interpreters/apertium/repository.py</code> <pre><code>def clear_modes(self) -&gt; None:\n    \"\"\"Remove all mode files from the cache directory.\"\"\"\n    with pushd(self.cache_dir):\n        rm('-Rf', 'modes')\n</code></pre>"},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository.create_pair_package_alias","title":"create_pair_package_alias","text":"<pre><code>create_pair_package_alias(package_dir)\n</code></pre> <p>Create symbolic links for alternative language code formats.</p> <p>Creates aliases between ISO 639-1 (2-letter) and ISO 639-3 (3-letter) codes.</p> <p>Parameters:</p> Name Type Description Default <code>package_dir</code> <code>str</code> <p>Directory containing the extracted package.</p> required <p>Returns:</p> Type Description <code>str</code> <p>Path to the created alias directory.</p> Source code in <code>es_translator/interpreters/apertium/repository.py</code> <pre><code>def create_pair_package_alias(self, package_dir: str) -&gt; str:\n    \"\"\"Create symbolic links for alternative language code formats.\n\n    Creates aliases between ISO 639-1 (2-letter) and ISO 639-3 (3-letter) codes.\n\n    Args:\n        package_dir: Directory containing the extracted package.\n\n    Returns:\n        Path to the created alias directory.\n    \"\"\"\n    extraction_dir = dirname(package_dir) + '/'\n    source, target = basename(package_dir).split('apertium-')[-1].split('-')\n\n    # Determine alias codes based on current format\n    if len(source) == 2:\n        aliases = (to_alpha_3(source), to_alpha_3(target))\n    else:\n        aliases = (to_alpha_2(source), to_alpha_2(target))\n\n    # Build the alias dir using the alias codes\n    alias_dir = join(extraction_dir, f'apertium-{aliases[0]}-{aliases[1]}')\n    mode_file = join(extraction_dir, 'modes', f'{source}-{target}.mode')\n    mode_alias_file = join(extraction_dir, 'modes', f'{aliases[0]}-{aliases[1]}.mode')\n\n    # Use symbolic links for aliases\n    create_symlink(package_dir, alias_dir)\n    create_symlink(mode_file, mode_alias_file)\n\n    return alias_dir\n</code></pre>"},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository.download_package","title":"download_package","text":"<pre><code>download_package(name, force=False)\n</code></pre> <p>Download a package from the repository.</p> <p>Parameters:</p> Name Type Description Default <code>name</code> <code>str</code> <p>Package name to download.</p> required <code>force</code> <code>bool</code> <p>If True, re-download even if package already exists.</p> <code>False</code> <p>Returns:</p> Type Description <code>str</code> <p>Path to the downloaded .deb file.</p> <p>Raises:</p> Type Description <code>PackageNotFoundError</code> <p>If package cannot be found.</p> Source code in <code>es_translator/interpreters/apertium/repository.py</code> <pre><code>def download_package(self, name: str, force: bool = False) -&gt; str:\n    \"\"\"Download a package from the repository.\n\n    Args:\n        name: Package name to download.\n        force: If True, re-download even if package already exists.\n\n    Returns:\n        Path to the downloaded .deb file.\n\n    Raises:\n        PackageNotFoundError: If package cannot be found.\n    \"\"\"\n    package = self.find_package(name)\n    if package is None:\n        raise PackageNotFoundError(name)\n\n    package_dir = join(self.cache_dir, name)\n    package_file = join(package_dir, 'package.deb')\n    mkdir('-p', package_dir)\n\n    # Don't download the file twice\n    if force or not isfile(package_file):\n        logger.info(f'Downloading package {name}')\n\n        # Try the URL from Packages file first\n        package_url = f'{REPOSITORY_URL}/{package[\"Filename\"]}'\n        try:\n            request.urlretrieve(package_url, package_file)\n        except (URLError, HTTPError, OSError) as e:\n            # If that fails, try to find the latest version in the pool directory\n            logger.warning(f'Failed to download from Packages file URL: {e}')\n            package_url = self.find_latest_package_in_pool(name, package['Filename'])\n            request.urlretrieve(package_url, package_file)\n\n    return package_file\n</code></pre>"},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository.download_pair_package","title":"download_pair_package","text":"<pre><code>download_pair_package(pair)\n</code></pre> <p>Download a translation pair package.</p> <p>Parameters:</p> Name Type Description Default <code>pair</code> <code>str</code> <p>Language pair in format 'source-target'.</p> required <p>Returns:</p> Type Description <code>str</code> <p>Path to the downloaded .deb file.</p> <p>Raises:</p> Type Description <code>PairPackageNotFoundError</code> <p>If no pair package is available for the given languages.</p> Source code in <code>es_translator/interpreters/apertium/repository.py</code> <pre><code>def download_pair_package(self, pair: str) -&gt; str:\n    \"\"\"Download a translation pair package.\n\n    Args:\n        pair: Language pair in format 'source-target'.\n\n    Returns:\n        Path to the downloaded .deb file.\n\n    Raises:\n        PairPackageNotFoundError: If no pair package is available for the given languages.\n    \"\"\"\n    pair_package = self.find_pair_package(pair)\n    if pair_package is not None:\n        return self.download_package(pair_package.get('Package'))\n    else:\n        raise PairPackageNotFoundError(pair)\n</code></pre>"},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository.extract_pair_package","title":"extract_pair_package","text":"<pre><code>extract_pair_package(file, extraction_dir='.')\n</code></pre> <p>Extract a translation pair .deb package.</p> <p>Parameters:</p> Name Type Description Default <code>file</code> <code>str</code> <p>Path to the .deb file to extract.</p> required <code>extraction_dir</code> <code>str</code> <p>Directory to extract files into. Defaults to '.'.</p> <code>'.'</code> <p>Returns:</p> Type Description <code>str</code> <p>Path to the working directory containing extracted files.</p> Source code in <code>es_translator/interpreters/apertium/repository.py</code> <pre><code>def extract_pair_package(self, file: str, extraction_dir: str = '.') -&gt; str:\n    \"\"\"Extract a translation pair .deb package.\n\n    Args:\n        file: Path to the .deb file to extract.\n        extraction_dir: Directory to extract files into. Defaults to '.'.\n\n    Returns:\n        Path to the working directory containing extracted files.\n    \"\"\"\n    workdir = dirname(file)\n    with pushd(workdir):\n        # Extract the file from the .deb\n        dpkg_deb('-x', file, extraction_dir)\n        # Copy the files we need\n        cp('-rlf', glob('usr/share/apertium/*'), extraction_dir)\n        # Remove everything else\n        rm('-Rf', 'usr')\n        # Rewrite paths in modes files to point to the working directory\n        for mode in glob('modes/*.mode'):\n            self.replace_in_file(mode, '/usr/share/apertium', workdir)\n    return workdir\n</code></pre>"},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository.find_latest_package_in_pool","title":"find_latest_package_in_pool","text":"<pre><code>find_latest_package_in_pool(package_name, filename)\n</code></pre> <p>Find latest package version from pool directory.</p> <p>Used as fallback when the Packages file lists an outdated version.</p> <p>Parameters:</p> Name Type Description Default <code>package_name</code> <code>str</code> <p>Name of the package to find.</p> required <code>filename</code> <code>str</code> <p>Original filename from Packages file (used to determine pool directory).</p> required <p>Returns:</p> Type Description <code>str</code> <p>URL of the latest package version found.</p> <p>Raises:</p> Type Description <code>Exception</code> <p>If no matching package is found in the pool directory.</p> <code>URLError</code> <p>If the pool directory cannot be accessed.</p> Source code in <code>es_translator/interpreters/apertium/repository.py</code> <pre><code>def find_latest_package_in_pool(self, package_name: str, filename: str) -&gt; str:\n    \"\"\"Find latest package version from pool directory.\n\n    Used as fallback when the Packages file lists an outdated version.\n\n    Args:\n        package_name: Name of the package to find.\n        filename: Original filename from Packages file (used to determine pool directory).\n\n    Returns:\n        URL of the latest package version found.\n\n    Raises:\n        Exception: If no matching package is found in the pool directory.\n        URLError: If the pool directory cannot be accessed.\n    \"\"\"\n    logger.info('Attempting to find latest version from pool directory')\n\n    # Extract the pool directory path\n    filename_parts = filename.split('/')\n    pool_dir_url = f'{REPOSITORY_URL}/{\"/\".join(filename_parts[:-1])}/'\n\n    try:\n        # Fetch the directory listing\n        response = request.urlopen(pool_dir_url)\n        html_content = response.read().decode('utf-8')\n    except (URLError, HTTPError) as e:\n        logger.error(f'Failed to access pool directory {pool_dir_url}: {e}')\n        raise\n\n    # Find all .deb files for this package\n    pattern = rf'href=\"({re.escape(package_name)}_[^\"]+\\.deb)\"'\n    matches = re.findall(pattern, html_content)\n\n    if matches:\n        # Use the last one (likely the newest based on alphabetical sorting)\n        latest_file = matches[-1]\n        package_url = pool_dir_url + latest_file\n        logger.info(f'Found latest version: {latest_file}')\n        return package_url\n    else:\n        raise PackageNotFoundError(package_name)\n</code></pre>"},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository.find_package","title":"find_package","text":"<pre><code>find_package(package)\n</code></pre> <p>Find a package by name or provided name.</p> <p>Parameters:</p> Name Type Description Default <code>package</code> <code>str</code> <p>Package name to search for.</p> required <p>Returns:</p> Type Description <code>Optional[dict]</code> <p>Package metadata dictionary if found, None otherwise.</p> Source code in <code>es_translator/interpreters/apertium/repository.py</code> <pre><code>def find_package(self, package: str) -&gt; Optional[dict]:\n    \"\"\"Find a package by name or provided name.\n\n    Args:\n        package: Package name to search for.\n\n    Returns:\n        Package metadata dictionary if found, None otherwise.\n    \"\"\"\n\n    def is_package(c: dict) -&gt; bool:\n        return c.get('Package') == package or c.get('Provides') == package\n\n    try:\n        return next(filter(is_package, self.packages))\n    except StopIteration:\n        logger.warning(f'Unable to find package {package}')\n        return None\n</code></pre>"},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository.find_pair_package","title":"find_pair_package","text":"<pre><code>find_pair_package(pair)\n</code></pre> <p>Find a translation pair package.</p> <p>Searches for both forward (source-target) and reverse (target-source) pairs.</p> <p>Parameters:</p> Name Type Description Default <code>pair</code> <code>str</code> <p>Language pair in format 'source-target'.</p> required <p>Returns:</p> Type Description <code>Optional[dict]</code> <p>Package metadata dictionary if found, None otherwise.</p> Source code in <code>es_translator/interpreters/apertium/repository.py</code> <pre><code>def find_pair_package(self, pair: str) -&gt; Optional[dict]:\n    \"\"\"Find a translation pair package.\n\n    Searches for both forward (source-target) and reverse (target-source) pairs.\n\n    Args:\n        pair: Language pair in format 'source-target'.\n\n    Returns:\n        Package metadata dictionary if found, None otherwise.\n    \"\"\"\n    pair = to_alpha_3_pair(pair)\n    pair_inversed = '-'.join(pair.split('-')[::-1])\n\n    def is_pair(c: dict) -&gt; bool:\n        package_name = c.get('Package', '')\n        return package_name.endswith(pair) or package_name.endswith(pair_inversed)\n\n    try:\n        return next(filter(is_pair, self.pair_packages))\n    except StopIteration:\n        return None\n</code></pre>"},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository.import_modes","title":"import_modes","text":"<pre><code>import_modes(clear=True)\n</code></pre> <p>Import all mode files from installed packages into the modes directory.</p> <p>Parameters:</p> Name Type Description Default <code>clear</code> <code>bool</code> <p>If True, clear existing modes before importing. Defaults to True.</p> <code>True</code> Source code in <code>es_translator/interpreters/apertium/repository.py</code> <pre><code>def import_modes(self, clear: bool = True) -&gt; None:\n    \"\"\"Import all mode files from installed packages into the modes directory.\n\n    Args:\n        clear: If True, clear existing modes before importing. Defaults to True.\n    \"\"\"\n    with pushd(self.cache_dir):\n        if clear:\n            self.clear_modes()\n        mkdir('-p', 'modes')\n        # Copy all the mode files from installed packages\n        mode_files = glob('./*/modes/*.mode')\n        if mode_files:\n            cp(mode_files, './modes')\n</code></pre>"},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository.install_pair_package","title":"install_pair_package","text":"<pre><code>install_pair_package(pair)\n</code></pre> <p>Download, extract, and install a translation pair package.</p> <p>Parameters:</p> Name Type Description Default <code>pair</code> <code>str</code> <p>Language pair in format 'source-target'.</p> required <p>Returns:</p> Type Description <code>str</code> <p>Path to the installed package directory.</p> Source code in <code>es_translator/interpreters/apertium/repository.py</code> <pre><code>def install_pair_package(self, pair: str) -&gt; str:\n    \"\"\"Download, extract, and install a translation pair package.\n\n    Args:\n        pair: Language pair in format 'source-target'.\n\n    Returns:\n        Path to the installed package directory.\n    \"\"\"\n    logger.info(f'Installing pair package {pair}')\n    package_file = self.download_pair_package(pair)\n    package_dir = self.extract_pair_package(package_file)\n    self.create_pair_package_alias(package_dir)\n    self.import_modes(clear=False)\n    return package_dir\n</code></pre>"},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository.is_apertium_pair","title":"is_apertium_pair","text":"<pre><code>is_apertium_pair(control)\n</code></pre> <p>Check if a package is an Apertium translation pair.</p> <p>Parameters:</p> Name Type Description Default <code>control</code> <code>dict</code> <p>Package metadata dictionary.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if package is a translation pair (format: apertium-XX-YY).</p> Source code in <code>es_translator/interpreters/apertium/repository.py</code> <pre><code>def is_apertium_pair(self, control: dict) -&gt; bool:\n    \"\"\"Check if a package is an Apertium translation pair.\n\n    Args:\n        control: Package metadata dictionary.\n\n    Returns:\n        True if package is a translation pair (format: apertium-XX-YY).\n    \"\"\"\n    try:\n        parts = control['Package'].split('-')\n        return len(parts) == 3 and parts[0] == 'apertium'\n    except KeyError:\n        return False\n</code></pre>"},{"location":"api/#es_translator.interpreters.apertium.repository.ApertiumRepository.replace_in_file","title":"replace_in_file","text":"<pre><code>replace_in_file(file, target, replacement)\n</code></pre> <p>Replace all occurrences of target string in a file.</p> <p>Parameters:</p> Name Type Description Default <code>file</code> <code>str</code> <p>Path to the file to modify.</p> required <code>target</code> <code>str</code> <p>String to search for.</p> required <code>replacement</code> <code>str</code> <p>String to replace with.</p> required Source code in <code>es_translator/interpreters/apertium/repository.py</code> <pre><code>def replace_in_file(self, file: str, target: str, replacement: str) -&gt; None:\n    \"\"\"Replace all occurrences of target string in a file.\n\n    Args:\n        file: Path to the file to modify.\n        target: String to search for.\n        replacement: String to replace with.\n    \"\"\"\n    with FileInput(file, inplace=True) as fileinput:\n        for line in fileinput:\n            print(line.replace(target, replacement), end='')\n</code></pre>"},{"location":"architecture/","title":"Architecture","text":"<p>This page explains es-translator's architecture and how its components work together.</p>"},{"location":"architecture/#overview","title":"Overview","text":"<p>es-translator is a Python application that reads documents from Elasticsearch, translates them using a pluggable interpreter system, and writes the translations back.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           es-translator                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  EsTranslator \u2502\u2500\u2500\u2500\u25b6\u2502    Interpreter   \u2502\u2500\u2500\u2500\u25b6\u2502  TranslatedHit  \u2502  \u2502\n\u2502  \u2502     (core)    \u2502    \u2502 (Argos/Apertium) \u2502    \u2502    (result)     \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                                          \u2502\n         \u25bc                                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Elasticsearch  \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  Elasticsearch  \u2502\n\u2502    (read)       \u2502                      \u2502    (write)      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/#core-components","title":"Core Components","text":""},{"location":"architecture/#estranslator","title":"EsTranslator","text":"<p>The main orchestrator class (<code>es_translator/es_translator.py</code>) that:</p> <ul> <li>Connects to Elasticsearch</li> <li>Configures and executes search queries</li> <li>Manages worker pools for parallel processing</li> <li>Coordinates the translation pipeline</li> </ul> <pre><code>from es_translator import EsTranslator\n\ntranslator = EsTranslator({\n    'url': 'http://localhost:9200',\n    'index': 'my-index',\n    'source_language': 'fr',\n    'target_language': 'en',\n    'interpreter': 'ARGOS',\n    ...\n})\ntranslator.start()\n</code></pre>"},{"location":"architecture/#interpreters","title":"Interpreters","text":"<p>Interpreters are pluggable translation backends. All interpreters inherit from <code>AbstractInterpreter</code>:</p> <pre><code>AbstractInterpreter\n\u251c\u2500\u2500 Argos      (Neural MT via argostranslate)\n\u2514\u2500\u2500 Apertium   (Rule-based MT via apertium)\n</code></pre> <p>Each interpreter implements:</p> <ul> <li><code>translate(text)</code> - Translate text from source to target language</li> <li><code>is_pair_available</code> - Check if the language pair is supported</li> <li>Language code conversion (ISO 639-1/639-3)</li> </ul>"},{"location":"architecture/#translatedhit","title":"TranslatedHit","text":"<p>Wraps Elasticsearch document hits (<code>es_translator/es.py</code>) and handles:</p> <ul> <li>Reading source content from documents</li> <li>Managing translation results</li> <li>Checking for existing translations</li> <li>Saving updated documents back to Elasticsearch</li> </ul>"},{"location":"architecture/#processing-modes","title":"Processing Modes","text":""},{"location":"architecture/#instant-mode-default","title":"Instant Mode (Default)","text":"<p>Documents are translated immediately as they're retrieved:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Scan     \u2502\u2500\u2500\u2500\u2500\u25b6\u2502  Translate  \u2502\u2500\u2500\u2500\u2500\u25b6\u2502    Save     \u2502\n\u2502  (scroll)   \u2502     \u2502  (parallel) \u2502     \u2502   (bulk)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <pre><code>es-translator --url ... --index ... -s fr -t en\n</code></pre>"},{"location":"architecture/#planned-mode-distributed","title":"Planned Mode (Distributed)","text":"<p>Documents are queued for later processing via Celery:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Planning Phase                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502    Scan     \u2502\u2500\u2500\u2500\u2500\u25b6\u2502   Queue     \u2502\u2500\u2500\u2500\u2500\u25b6\u2502    Redis    \u2502        \u2502\n\u2502  \u2502  (scroll)   \u2502     \u2502   Tasks     \u2502     \u2502   (broker)  \u2502        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                  \u2502\n                                                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        Execution Phase                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502   Worker    \u2502\u2500\u2500\u2500\u2500\u25b6\u2502  Translate  \u2502\u2500\u2500\u2500\u2500\u25b6\u2502    Save     \u2502        \u2502\n\u2502  \u2502  (Celery)   \u2502     \u2502             \u2502     \u2502             \u2502        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502   Worker    \u2502\u2500\u2500\u2500\u2500\u25b6\u2502  Translate  \u2502\u2500\u2500\u2500\u2500\u25b6\u2502    Save     \u2502        \u2502\n\u2502  \u2502  (Celery)   \u2502     \u2502             \u2502     \u2502             \u2502        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <pre><code># Plan\nes-translator --url ... --index ... -s fr -t en --broker-url redis://... --plan\n\n# Execute\nes-translator-tasks --broker-url redis://... --concurrency 4\n</code></pre>"},{"location":"architecture/#parallel-processing","title":"Parallel Processing","text":"<p>es-translator uses Python's <code>multiprocessing</code> module for parallel translation:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        Main Process                           \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502                   JoinableQueue                         \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510       \u2502  \u2502\n\u2502  \u2502  \u2502doc1\u2502 \u2502doc2\u2502 \u2502doc3\u2502 \u2502doc4\u2502 \u2502doc5\u2502 \u2502doc6\u2502 \u2502... \u2502       \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518       \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502           \u2502           \u2502           \u2502\n         \u25bc           \u25bc           \u25bc           \u25bc\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502 Worker  \u2502 \u2502 Worker  \u2502 \u2502 Worker  \u2502 \u2502 Worker  \u2502\n    \u2502   1     \u2502 \u2502   2     \u2502 \u2502   3     \u2502 \u2502   4     \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Configure with <code>--pool-size</code>:</p> <pre><code>es-translator --pool-size 4 ...\n</code></pre>"},{"location":"architecture/#technology-stack","title":"Technology Stack","text":"Component Technology Purpose Core Python 3.9+ Main application CLI Click Command-line interface Search elasticsearch-dsl Elasticsearch queries Neural MT argostranslate Argos interpreter Rule-based MT Apertium (system) Apertium interpreter Task Queue Celery Distributed processing Message Broker Redis Task queue backend Progress Rich Terminal progress bars Logging coloredlogs Colored log output"},{"location":"architecture/#data-flow","title":"Data Flow","text":""},{"location":"architecture/#document-translation-flow","title":"Document Translation Flow","text":"<pre><code>1. Search\n   \u2514\u2500\u2500 Query Elasticsearch with scroll API\n       \u2514\u2500\u2500 Retrieve batch of documents\n\n2. Queue\n   \u2514\u2500\u2500 Add documents to processing queue\n       \u2514\u2500\u2500 Workers pick up documents\n\n3. Translate\n   \u2514\u2500\u2500 Worker extracts source content\n       \u2514\u2500\u2500 Interpreter translates text\n           \u2514\u2500\u2500 Create translation result\n\n4. Save\n   \u2514\u2500\u2500 Update document with translation\n       \u2514\u2500\u2500 Write back to Elasticsearch\n</code></pre>"},{"location":"architecture/#translation-result-format","title":"Translation Result Format","text":"<p>Documents are updated with a translation array:</p> <pre><code>{\n  \"content\": \"Bonjour le monde\",\n  \"content_translated\": [\n    {\n      \"translator\": \"ARGOS\",\n      \"source_language\": \"FRENCH\",\n      \"target_language\": \"ENGLISH\",\n      \"content\": \"Hello world\"\n    }\n  ]\n}\n</code></pre> <p>Multiple translations (different language pairs) are appended to the array.</p>"},{"location":"architecture/#configuration","title":"Configuration","text":""},{"location":"architecture/#environment-variables","title":"Environment Variables","text":"<p>All CLI defaults can be overridden via environment variables:</p> <pre><code>export ES_TRANSLATOR_ELASTICSEARCH_URL=\"http://elasticsearch:9200\"\nexport ES_TRANSLATOR_REDIS_URL=\"redis://redis:6379\"\nexport ES_TRANSLATOR_INTERPRETER=\"ARGOS\"\n</code></pre> <p>See Configuration for the complete list.</p>"},{"location":"architecture/#module-structure","title":"Module Structure","text":"<pre><code>es_translator/\n\u251c\u2500\u2500 __init__.py           # Package exports\n\u251c\u2500\u2500 es_translator.py      # Main EsTranslator class\n\u251c\u2500\u2500 es.py                 # TranslatedHit class\n\u251c\u2500\u2500 cli.py                # Click CLI commands\n\u251c\u2500\u2500 config.py             # Configuration defaults\n\u251c\u2500\u2500 worker.py             # Translation worker\n\u251c\u2500\u2500 tasks.py              # Celery tasks\n\u251c\u2500\u2500 logger.py             # Logging setup\n\u251c\u2500\u2500 alpha.py              # Language code utilities\n\u251c\u2500\u2500 symlink.py            # File utilities\n\u2514\u2500\u2500 interpreters/\n    \u251c\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 abstract.py       # AbstractInterpreter base class\n    \u251c\u2500\u2500 argos/\n    \u2502   \u251c\u2500\u2500 __init__.py\n    \u2502   \u2514\u2500\u2500 argos.py      # Argos interpreter\n    \u2514\u2500\u2500 apertium/\n        \u251c\u2500\u2500 __init__.py\n        \u251c\u2500\u2500 apertium.py   # Apertium interpreter\n        \u251c\u2500\u2500 repository.py # Package management\n        \u2514\u2500\u2500 pairs.py      # Language pairs listing\n</code></pre>"},{"location":"architecture/#error-handling","title":"Error Handling","text":""},{"location":"architecture/#exception-hierarchy","title":"Exception Hierarchy","text":"<pre><code>Exception\n\u251c\u2500\u2500 InvalidLanguageCode      # Invalid language code\n\u251c\u2500\u2500 ApertiumNotInstalledError # Apertium not available\n\u251c\u2500\u2500 PackageNotFoundError     # Repository package not found\n\u251c\u2500\u2500 PairPackageNotFoundError # Language pair not available\n\u251c\u2500\u2500 ArgosPairNotAvailable    # Argos pair not supported\n\u2514\u2500\u2500 FatalTranslationException # Unrecoverable error\n</code></pre>"},{"location":"architecture/#worker-error-recovery","title":"Worker Error Recovery","text":"<p>Workers handle errors gracefully:</p> <ul> <li>Elasticsearch errors: Logged and marked as fatal (stops processing)</li> <li>Translation errors: Logged and skipped (continues with next document)</li> <li>Timeout errors: Logged and retried</li> </ul>"},{"location":"architecture/#extending-es-translator","title":"Extending es-translator","text":""},{"location":"architecture/#adding-a-new-interpreter","title":"Adding a New Interpreter","text":"<ol> <li>Create a new class inheriting from <code>AbstractInterpreter</code>:</li> </ol> <pre><code>from es_translator.interpreters.abstract import AbstractInterpreter\n\nclass MyInterpreter(AbstractInterpreter):\n    name = 'MY_INTERPRETER'\n\n    def translate(self, text_input: str) -&gt; str:\n        # Your translation logic\n        return translated_text\n</code></pre> <ol> <li> <p>Register in <code>es_translator/interpreters/__init__.py</code></p> </li> <li> <p>Add to CLI validation in <code>es_translator/cli.py</code></p> </li> </ol>"},{"location":"configuration/","title":"Configuration","text":"<p>es-translator can be configured via command-line options or environment variables.</p>"},{"location":"configuration/#environment-variables","title":"Environment Variables","text":"<p>All CLI defaults can be overridden via environment variables:</p> Variable Description Default <code>ES_TRANSLATOR_ELASTICSEARCH_URL</code> Elasticsearch URL <code>http://localhost:9200</code> <code>ES_TRANSLATOR_ELASTICSEARCH_INDEX</code> Default index name <code>local-datashare</code> <code>ES_TRANSLATOR_REDIS_URL</code> Redis URL for Celery <code>redis://localhost:6379</code> <code>ES_TRANSLATOR_BROKER_URL</code> Celery broker URL Same as <code>ES_TRANSLATOR_REDIS_URL</code> <code>ES_TRANSLATOR_INTERPRETER</code> Default interpreter <code>ARGOS</code> <code>ES_TRANSLATOR_SOURCE_FIELD</code> Default source field <code>content</code> <code>ES_TRANSLATOR_TARGET_FIELD</code> Default target field <code>content_translated</code> <code>ES_TRANSLATOR_MAX_CONTENT_LENGTH</code> Max content length <code>19G</code> <code>ES_TRANSLATOR_DEVICE</code> Device for Argos (cpu, cuda, auto) <code>auto</code> <code>ES_TRANSLATOR_POOL_SIZE</code> Default worker pool size <code>1</code> <code>ES_TRANSLATOR_POOL_TIMEOUT</code> Worker timeout (seconds) <code>1800</code> <code>ES_TRANSLATOR_SCAN_SCROLL</code> Elasticsearch scroll duration <code>5m</code> <code>ES_TRANSLATOR_SYSLOG_ADDRESS</code> Syslog server address <code>localhost</code> <code>ES_TRANSLATOR_SYSLOG_PORT</code> Syslog server port <code>514</code> <code>ES_TRANSLATOR_SYSLOG_FACILITY</code> Syslog facility <code>local7</code>"},{"location":"configuration/#usage-examples","title":"Usage Examples","text":""},{"location":"configuration/#docker-with-environment-variables","title":"Docker with Environment Variables","text":"<pre><code>docker run \\\n  -e ES_TRANSLATOR_ELASTICSEARCH_URL=\"http://elasticsearch:9200\" \\\n  -e ES_TRANSLATOR_REDIS_URL=\"redis://redis:6379\" \\\n  icij/es-translator es-translator \\\n    --index my-index \\\n    --source-language fr \\\n    --target-language en\n</code></pre>"},{"location":"configuration/#docker-compose","title":"Docker Compose","text":"<pre><code>services:\n  es-translator:\n    image: icij/es-translator\n    environment:\n      ES_TRANSLATOR_ELASTICSEARCH_URL: http://elasticsearch:9200\n      ES_TRANSLATOR_REDIS_URL: redis://redis:6379\n      ES_TRANSLATOR_INTERPRETER: ARGOS\n      ES_TRANSLATOR_POOL_SIZE: 4\n</code></pre>"},{"location":"configuration/#shell-export","title":"Shell Export","text":"<pre><code>export ES_TRANSLATOR_ELASTICSEARCH_URL=\"http://localhost:9200\"\nexport ES_TRANSLATOR_INTERPRETER=\"ARGOS\"\n\nes-translator --index my-index -s fr -t en\n</code></pre>"},{"location":"configuration/#cli-options-reference","title":"CLI Options Reference","text":""},{"location":"configuration/#es-translator","title":"es-translator","text":"Option Environment Variable Default Description <code>-u, --url</code> <code>ES_TRANSLATOR_ELASTICSEARCH_URL</code> <code>http://localhost:9200</code> Elasticsearch URL <code>-i, --index</code> <code>ES_TRANSLATOR_ELASTICSEARCH_INDEX</code> <code>local-datashare</code> Elasticsearch index <code>-r, --interpreter</code> <code>ES_TRANSLATOR_INTERPRETER</code> <code>ARGOS</code> Translation interpreter <code>-s, --source-language</code> - required Source language code <code>-t, --target-language</code> - required Target language code <code>--intermediary-language</code> - - Intermediary language (Apertium) <code>--source-field</code> <code>ES_TRANSLATOR_SOURCE_FIELD</code> <code>content</code> Field to translate <code>--target-field</code> <code>ES_TRANSLATOR_TARGET_FIELD</code> <code>content_translated</code> Field for translations <code>-q, --query-string</code> - - Elasticsearch query filter <code>-d, --data-dir</code> - temp directory Language model directory <code>--scan-scroll</code> <code>ES_TRANSLATOR_SCAN_SCROLL</code> <code>5m</code> Scroll duration <code>--dry-run</code> - <code>false</code> Don't save to Elasticsearch <code>-f, --force</code> - <code>false</code> Re-translate existing <code>--pool-size</code> <code>ES_TRANSLATOR_POOL_SIZE</code> <code>1</code> Parallel workers <code>--pool-timeout</code> <code>ES_TRANSLATOR_POOL_TIMEOUT</code> <code>1800</code> Worker timeout (s) <code>--throttle</code> - <code>0</code> Delay between translations (ms) <code>--progressbar</code> - auto Show progress bar <code>--plan</code> - <code>false</code> Queue for distributed mode <code>--broker-url</code> <code>ES_TRANSLATOR_BROKER_URL</code> <code>redis://localhost:6379</code> Celery broker URL <code>--max-content-length</code> <code>ES_TRANSLATOR_MAX_CONTENT_LENGTH</code> <code>19G</code> Max content length <code>--device</code> <code>ES_TRANSLATOR_DEVICE</code> <code>auto</code> Device for Argos (cpu, cuda, auto) <code>--stdout-loglevel</code> - <code>ERROR</code> Log level <code>--syslog-address</code> <code>ES_TRANSLATOR_SYSLOG_ADDRESS</code> <code>localhost</code> Syslog address <code>--syslog-port</code> <code>ES_TRANSLATOR_SYSLOG_PORT</code> <code>514</code> Syslog port <code>--syslog-facility</code> <code>ES_TRANSLATOR_SYSLOG_FACILITY</code> <code>local7</code> Syslog facility"},{"location":"configuration/#es-translator-tasks","title":"es-translator-tasks","text":"Option Environment Variable Default Description <code>--broker-url</code> <code>ES_TRANSLATOR_BROKER_URL</code> <code>redis://localhost:6379</code> Celery broker URL <code>--concurrency</code> <code>ES_TRANSLATOR_POOL_SIZE</code> <code>1</code> Concurrent workers <code>--stdout-loglevel</code> - <code>ERROR</code> Log level"},{"location":"configuration/#es-translator-pairs","title":"es-translator-pairs","text":"Option Default Description <code>--data-dir</code> temp directory Language pack directory <code>--local</code> <code>false</code> Show local pairs only <code>--stdout-loglevel</code> <code>ERROR</code> Log level"},{"location":"configuration/#es-translator-monitor","title":"es-translator-monitor","text":"Option Environment Variable Default Description <code>--broker-url</code> <code>ES_TRANSLATOR_BROKER_URL</code> <code>redis://localhost:6379</code> Celery broker URL <code>--refresh</code> - <code>2.0</code> Refresh interval (seconds) <code>--history</code> - <code>60.0</code> Throughput history duration (seconds) <code>--chart-scale</code> - <code>s</code> Throughput scale for chart (s, min, h) <code>--worker-scale</code> - <code>min</code> Throughput scale for workers table (s, min, h) <code>--worker-throughput-lifespan</code> - <code>30.0</code> Duration to average per-worker throughput (seconds)"},{"location":"configuration/#content-length-format","title":"Content Length Format","text":"<p>The <code>--max-content-length</code> option accepts values with size suffixes:</p> Format Value <code>100</code> 100 bytes <code>10K</code> 10 KB (10,240 bytes) <code>5M</code> 5 MB (5,242,880 bytes) <code>1G</code> 1 GB (1,073,741,824 bytes) <code>19G</code> 19 GB (default for Datashare)"},{"location":"configuration/#log-levels","title":"Log Levels","text":"<p>Available log levels for <code>--stdout-loglevel</code>:</p> Level Description <code>DEBUG</code> Detailed debugging information <code>INFO</code> General operational messages <code>WARNING</code> Warning messages <code>ERROR</code> Error messages only (default) <code>CRITICAL</code> Critical errors only"},{"location":"configuration/#language-codes","title":"Language Codes","text":"<p>es-translator accepts both ISO 639-1 (2-letter) and ISO 639-3 (3-letter) language codes:</p> Language 2-letter 3-letter English <code>en</code> <code>eng</code> French <code>fr</code> <code>fra</code> Spanish <code>es</code> <code>spa</code> German <code>de</code> <code>deu</code> Portuguese <code>pt</code> <code>por</code> Italian <code>it</code> <code>ita</code> <p>Both formats are accepted and normalized internally.</p>"},{"location":"contributing/","title":"Contributing to EsTranslator","text":"<p>Thank you for your interest in contributing to the EsTranslator project! We welcome contributions from the community to help improve and grow the library. This document provides guidelines and information on how you can contribute effectively.</p>"},{"location":"contributing/#ways-to-contribute","title":"Ways to Contribute","text":"<p>There are several ways you can contribute to the EsTranslator project:</p> <ol> <li> <p>Report Issues: If you encounter any bugs, issues, or have feature requests, please submit an issue on our GitHub repository. Include as much detail as possible to help us understand and address the problem.</p> </li> <li> <p>Provide Feedback: If you have feedback or suggestions for improving EsTranslator, we would love to hear from you. You can share your thoughts by opening a new issue or participating in discussions on existing issues.</p> </li> <li> <p>Submit Pull Requests: If you'd like to contribute code changes, bug fixes, or new features, you can submit a pull request. Follow the guidelines below to ensure a smooth review and merge process.</p> </li> </ol>"},{"location":"contributing/#development-setup","title":"Development Setup","text":"<p>To set up a development environment for EsTranslator, follow these steps:</p> <ol> <li>Install Apertium:</li> </ol> <pre><code>wget https://apertium.projectjj.com/apt/install-nightly.sh -O - | sudo bash\nsudo apt install apertium-all-dev\n</code></pre> <ol> <li>Clone the repository:</li> </ol> <pre><code>git clone https://github.com/icij/es-translator.git\n</code></pre> <ol> <li>Install the required dependencies:</li> </ol> <pre><code>cd es-translator\nmake install\n</code></pre> <ol> <li>Run tests to verify the setup:</li> </ol> <pre><code>make test\n</code></pre>"},{"location":"contributing/#development-commands","title":"Development Commands","text":"<p>The project uses a Makefile for common development tasks. Here's a reference of available commands:</p>"},{"location":"contributing/#code-quality","title":"Code Quality","text":"Command Description <code>make lint</code> Run ruff linter to check for code issues <code>make lint-fix</code> Automatically fix linting issues where possible"},{"location":"contributing/#testing","title":"Testing","text":"Command Description <code>make test</code> Run the test suite with pytest"},{"location":"contributing/#documentation","title":"Documentation","text":"Command Description <code>make serve-doc</code> Start a local documentation server for preview <code>make publish-doc</code> Deploy documentation to GitHub Pages"},{"location":"contributing/#building-cleaning","title":"Building &amp; Cleaning","text":"Command Description <code>make install</code> Install project dependencies via Poetry <code>make clean</code> Remove build artifacts, cache files, and compiled Python files"},{"location":"contributing/#development-workflow","title":"Development Workflow","text":"<p>A typical development workflow looks like:</p> <pre><code># 1. Make your changes to the code\n\n# 2. Run linting to check for issues\nmake lint\n\n# 3. Fix any auto-fixable issues\nmake lint-fix\n\n# 4. Run tests to ensure nothing is broken\nmake test\n\n# 5. Preview documentation changes (if applicable)\nmake serve-doc\n</code></pre>"},{"location":"contributing/#code-contribution-guidelines","title":"Code Contribution Guidelines","text":"<p>When contributing code changes, please adhere to the following guidelines:</p> <ul> <li>Fork the repository and create a new branch for your changes.</li> <li>Ensure your code follows the existing code style and conventions.</li> <li>Run <code>make lint</code> to check for linting issues before committing.</li> <li>Write clear and concise commit messages. We recommend using conventional commits.</li> <li>Include tests to cover your changes and ensure they pass.</li> <li>Update documentation as necessary.</li> <li>Submit a pull request to the <code>master</code> branch of the main repository.</li> </ul>"},{"location":"contributing/#license","title":"License","text":"<p>By contributing to the EsTranslator project, you agree that your contributions will be licensed under the MIT License. You retain the copyright to your contributions.</p>"},{"location":"contributing/#code-of-conduct","title":"Code of Conduct","text":"<p>We expect all contributors to follow the Code of Conduct when contributing to EsTranslator.</p>"},{"location":"datashare/","title":"Using with Datashare","text":"<p>Datashare is ICIJ's open-source document analysis platform. es-translator was specifically designed to work with Datashare's Elasticsearch indices.</p>"},{"location":"datashare/#overview","title":"Overview","text":"<p>Datashare stores extracted document content in Elasticsearch. es-translator can translate this content, making documents searchable in multiple languages.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Datashare  \u2502\u2500\u2500\u2500\u2500\u25b6\u2502  Elasticsearch  \u2502\u25c0\u2500\u2500\u2500\u2500\u2502  es-translator  \u2502\n\u2502  (extract)  \u2502     \u2502    (storage)    \u2502     \u2502   (translate)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"datashare/#document-structure","title":"Document Structure","text":"<p>Datashare documents in Elasticsearch have this structure:</p> <pre><code>{\n  \"content\": \"Original document text...\",\n  \"contentTranslated\": [\n    {\n      \"content\": \"Translated text...\",\n      \"source_language\": \"FRENCH\",\n      \"target_language\": \"ENGLISH\",\n      \"translator\": \"ARGOS\"\n    }\n  ],\n  \"type\": \"Document\",\n  \"path\": \"/path/to/file.pdf\",\n  ...\n}\n</code></pre>"},{"location":"datashare/#basic-usage","title":"Basic Usage","text":""},{"location":"datashare/#translate-all-documents","title":"Translate All Documents","text":"<p>Translate all documents from French to English:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index local-datashare \\\n  --source-language fr \\\n  --target-language en \\\n  --source-field content \\\n  --target-field contentTranslated\n</code></pre>"},{"location":"datashare/#translate-only-documents-skip-named-entities","title":"Translate Only Documents (Skip Named Entities)","text":"<p>Datashare indices contain both documents and named entities. To translate only documents:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index local-datashare \\\n  --source-language fr \\\n  --target-language en \\\n  --source-field content \\\n  --target-field contentTranslated \\\n  --query-string \"type:Document AND language:FRENCH\"\n</code></pre>"},{"location":"datashare/#translate-specific-project","title":"Translate Specific Project","text":"<p>If you have multiple Datashare projects:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-project \\\n  --source-language fr \\\n  --target-language en \\\n  --source-field content \\\n  --target-field contentTranslated\n</code></pre>"},{"location":"datashare/#handling-large-datasets","title":"Handling Large Datasets","text":"<p>Datashare projects can contain millions of documents. Here's how to handle them efficiently.</p>"},{"location":"datashare/#use-distributed-translation","title":"Use Distributed Translation","text":"<p>For large projects, use the planning mode to distribute work:</p> <pre><code># Step 1: Queue all documents\nes-translator \\\n  --url \"http://localhost:9200\" \\\n  --index local-datashare \\\n  --source-language fr \\\n  --target-language en \\\n  --source-field content \\\n  --target-field contentTranslated \\\n  --broker-url \"redis://redis:6379\" \\\n  --query-string \"type:Document AND language:FRENCH\" \\\n  --plan\n\n# Step 2: Start multiple workers\nes-translator-tasks --broker-url \"redis://redis:6379\" --concurrency 4\n</code></pre>"},{"location":"datashare/#handle-content-length-limits","title":"Handle Content Length Limits","text":"<p>Datashare's highlighting feature has content length limits. Use <code>--max-content-length</code> to truncate translations:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index local-datashare \\\n  --source-language fr \\\n  --target-language en \\\n  --source-field content \\\n  --target-field contentTranslated \\\n  --max-content-length 19G\n</code></pre> <p>Why 19G?</p> <p>Datashare uses Lucene's highlighting which has internal limits. The <code>19G</code> value matches Datashare's expected maximum. See datashare#1184 for details.</p>"},{"location":"datashare/#prevent-scroll-timeout","title":"Prevent Scroll Timeout","text":"<p>For very large indices, increase the scroll duration:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index local-datashare \\\n  --source-language fr \\\n  --target-language en \\\n  --source-field content \\\n  --target-field contentTranslated \\\n  --scan-scroll 30m\n</code></pre>"},{"location":"datashare/#multiple-languages","title":"Multiple Languages","text":""},{"location":"datashare/#sequential-translation","title":"Sequential Translation","text":"<p>To translate documents into multiple target languages:</p> <pre><code># French to English\nes-translator \\\n  --url \"http://localhost:9200\" \\\n  --index local-datashare \\\n  --source-language fr \\\n  --target-language en \\\n  --source-field content \\\n  --target-field contentTranslated\n\n# French to Spanish\nes-translator \\\n  --url \"http://localhost:9200\" \\\n  --index local-datashare \\\n  --source-language fr \\\n  --target-language es \\\n  --source-field content \\\n  --target-field contentTranslated\n</code></pre> <p>Translations are appended to the <code>contentTranslated</code> array, so multiple translations can coexist.</p>"},{"location":"datashare/#troubleshooting","title":"Troubleshooting","text":""},{"location":"datashare/#connection-refused-to-elasticsearch","title":"\"Connection refused\" to Elasticsearch","text":"<p>If running es-translator in Docker and Elasticsearch is on the host:</p> <pre><code># Use host network mode\ndocker run --network host icij/es-translator es-translator ...\n\n# Or use host.docker.internal (Docker Desktop)\ndocker run icij/es-translator es-translator \\\n  --url \"http://host.docker.internal:9200\" ...\n</code></pre>"},{"location":"datashare/#documents-not-being-translated","title":"Documents Not Being Translated","text":"<p>Check if documents are being filtered correctly:</p> <pre><code># Test with dry-run and debug logging\nes-translator \\\n  --url \"http://localhost:9200\" \\\n  --index local-datashare \\\n  --source-language fr \\\n  --target-language en \\\n  --source-field content \\\n  --target-field contentTranslated \\\n  --query-string \"type:Document\" \\\n  --dry-run \\\n  --stdout-loglevel DEBUG\n</code></pre>"},{"location":"datashare/#existing-translations-not-overwritten","title":"Existing Translations Not Overwritten","text":"<p>By default, es-translator skips already-translated documents. Use <code>--force</code> to re-translate:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index local-datashare \\\n  --source-language fr \\\n  --target-language en \\\n  --source-field content \\\n  --target-field contentTranslated \\\n  --force\n</code></pre>"},{"location":"datashare/#environment-variables","title":"Environment Variables","text":"<p>When deploying with Datashare, you can configure es-translator via environment variables:</p> Variable Description Default <code>ES_TRANSLATOR_ELASTICSEARCH_URL</code> Elasticsearch URL <code>http://localhost:9200</code> <code>ES_TRANSLATOR_ELASTICSEARCH_INDEX</code> Default index <code>local-datashare</code> <code>ES_TRANSLATOR_REDIS_URL</code> Redis URL for Celery <code>redis://localhost:6379</code> <code>ES_TRANSLATOR_INTERPRETER</code> Default interpreter <code>ARGOS</code> <code>ES_TRANSLATOR_SOURCE_FIELD</code> Default source field <code>content</code> <code>ES_TRANSLATOR_TARGET_FIELD</code> Default target field <code>content_translated</code> <code>ES_TRANSLATOR_MAX_CONTENT_LENGTH</code> Max content length <code>19G</code>"},{"location":"releasing/","title":"Releasing","text":"<p>This guide describes how to release a new version of es-translator. Only maintainers with publish access can perform releases.</p>"},{"location":"releasing/#prerequisites","title":"Prerequisites","text":"<p>Before releasing, ensure you have:</p> <ul> <li>Push access to the GitHub repository</li> <li>PyPI credentials configured: <code>poetry config pypi-token.pypi &lt;your-token&gt;</code></li> <li>Docker Hub credentials (for Docker image publishing)</li> </ul>"},{"location":"releasing/#release-checklist","title":"Release Checklist","text":"<ul> <li>All tests pass (<code>make test</code>)</li> <li>Linting passes (<code>make lint</code>)</li> <li>Documentation is up to date</li> </ul>"},{"location":"releasing/#release-process","title":"Release Process","text":""},{"location":"releasing/#1-verify-tests-pass","title":"1. Verify Tests Pass","text":"<pre><code>make lint\nmake test\n</code></pre>"},{"location":"releasing/#2-bump-version","title":"2. Bump Version","text":"<p>Use semantic versioning targets:</p> Patch (bug fixes)Minor (new features)Major (breaking changes) <pre><code># 1.0.0 -&gt; 1.0.1\nmake patch\n</code></pre> <pre><code># 1.0.0 -&gt; 1.1.0\nmake minor\n</code></pre> <pre><code># 1.0.0 -&gt; 2.0.0\nmake major\n</code></pre> <p>This will:</p> <ol> <li>Update version in <code>pyproject.toml</code></li> <li>Create a commit: <code>build: bump to &lt;version&gt;</code></li> <li>Create a git tag with the version</li> </ol> <p>To set a specific version:</p> <pre><code>make set-version CURRENT_VERSION=1.2.3\n</code></pre>"},{"location":"releasing/#3-push-to-github","title":"3. Push to GitHub","text":"<pre><code>git push origin master\ngit push origin --tags\n</code></pre>"},{"location":"releasing/#4-publish-to-pypi","title":"4. Publish to PyPI","text":"<pre><code>make distribute\n</code></pre> <p>This builds and uploads the package to PyPI.</p>"},{"location":"releasing/#5-publish-docker-image","title":"5. Publish Docker Image","text":"<pre><code># First-time setup for multi-arch builds\nmake docker-setup-multiarch\n\n# Build and push\nmake docker-publish\n</code></pre> <p>This builds and pushes images with both version tag and <code>latest</code>.</p>"},{"location":"releasing/#6-update-documentation","title":"6. Update Documentation","text":"<pre><code>make publish-doc\n</code></pre>"},{"location":"releasing/#version-numbering","title":"Version Numbering","text":"<p>We follow Semantic Versioning:</p> Change Type Version Bump Example Bug fixes PATCH 1.0.0 \u2192 1.0.1 New features (backward compatible) MINOR 1.0.0 \u2192 1.1.0 Breaking changes MAJOR 1.0.0 \u2192 2.0.0"},{"location":"releasing/#makefile-reference","title":"Makefile Reference","text":"Target Description <code>make patch</code> Bump patch version (x.x.X) <code>make minor</code> Bump minor version (x.X.0) <code>make major</code> Bump major version (X.0.0) <code>make set-version CURRENT_VERSION=x.x.x</code> Set specific version <code>make distribute</code> Build and publish to PyPI <code>make docker-publish</code> Build and push Docker image <code>make docker-setup-multiarch</code> Setup multi-arch Docker builds <code>make publish-doc</code> Deploy docs to GitHub Pages"},{"location":"releasing/#troubleshooting","title":"Troubleshooting","text":""},{"location":"releasing/#pypi-upload-fails","title":"PyPI Upload Fails","text":"<p>Ensure your token is configured:</p> <pre><code>poetry config pypi-token.pypi &lt;your-token&gt;\n</code></pre>"},{"location":"releasing/#docker-push-fails","title":"Docker Push Fails","text":"<p>Login to Docker Hub:</p> <pre><code>docker login\n</code></pre>"},{"location":"releasing/#multi-arch-build-fails","title":"Multi-arch Build Fails","text":"<p>Setup buildx:</p> <pre><code>make docker-setup-multiarch\n</code></pre>"},{"location":"troubleshooting/","title":"Troubleshooting","text":"<p>Common issues and their solutions.</p>"},{"location":"troubleshooting/#translation-errors","title":"Translation Errors","text":""},{"location":"troubleshooting/#the-pair-is-not-available","title":"\"The pair is not available\"","text":"<p>The requested language pair isn't supported by the interpreter.</p> ArgosApertium <p>Argos automatically downloads language models. Ensure you have internet connectivity on first run.</p> <pre><code># Check if models download successfully\nes-translator \\\n  --url \"http://localhost:9200\" \\\n  --index test \\\n  --source-language fr \\\n  --target-language en \\\n  --stdout-loglevel DEBUG \\\n  --dry-run\n</code></pre> <p>List available pairs and use an intermediary language if needed:</p> <pre><code># List available pairs\nes-translator-pairs\n\n# Use intermediary language\nes-translator \\\n  --interpreter apertium \\\n  --source-language pt \\\n  --target-language en \\\n  --intermediary-language es \\\n  ...\n</code></pre>"},{"location":"troubleshooting/#apertium-is-not-installed","title":"\"Apertium is not installed\"","text":"<p>Apertium requires system packages. Install them:</p> <pre><code>wget https://apertium.projectjj.com/apt/install-nightly.sh -O - | sudo bash\nsudo apt install apertium-all-dev\n</code></pre> <p>Or use Argos instead (default, no installation required):</p> <pre><code>es-translator --interpreter argos ...\n</code></pre>"},{"location":"troubleshooting/#invalid-language-code","title":"Invalid Language Code","text":"<p>Use standard ISO 639-1 (2-letter) or ISO 639-3 (3-letter) codes:</p> Language Valid Invalid English <code>en</code>, <code>eng</code> <code>english</code>, <code>EN</code> French <code>fr</code>, <code>fra</code> <code>french</code>, <code>fre</code>"},{"location":"troubleshooting/#elasticsearch-issues","title":"Elasticsearch Issues","text":""},{"location":"troubleshooting/#connection-refused","title":"Connection Refused","text":"<p>Can't connect to Elasticsearch.</p> <p>Check Elasticsearch is running:</p> <pre><code>curl http://localhost:9200\n</code></pre> <p>Docker networking issues:</p> <pre><code># Use host network\ndocker run --network host icij/es-translator ...\n\n# Or use host.docker.internal (Docker Desktop)\ndocker run icij/es-translator es-translator \\\n  --url \"http://host.docker.internal:9200\" ...\n</code></pre>"},{"location":"troubleshooting/#scroll-context-lost","title":"Scroll Context Lost","text":"<p>For large datasets, the scroll context may expire.</p> <p>Increase scroll duration:</p> <pre><code>es-translator --scan-scroll 30m ...\n</code></pre> <p>Use planned mode for very large datasets:</p> <pre><code># Queue documents (no scroll needed during execution)\nes-translator --plan --broker-url redis://... ...\n\n# Process from queue\nes-translator-tasks --broker-url redis://...\n</code></pre>"},{"location":"troubleshooting/#index-not-found","title":"Index Not Found","text":"<p>Verify the index exists:</p> <pre><code>curl http://localhost:9200/_cat/indices\n</code></pre>"},{"location":"troubleshooting/#performance-issues","title":"Performance Issues","text":""},{"location":"troubleshooting/#translation-too-slow","title":"Translation Too Slow","text":"<p>Increase parallel workers:</p> <pre><code>es-translator --pool-size 4 ...\n</code></pre> <p>Use Apertium (faster but lower quality):</p> <pre><code>es-translator --interpreter apertium ...\n</code></pre> <p>Filter to translate only what's needed:</p> <pre><code>es-translator --query-string \"type:Document AND status:published\" ...\n</code></pre>"},{"location":"troubleshooting/#memory-issues","title":"Memory Issues","text":"<p>Large documents or too many workers can exhaust memory.</p> <p>Limit content length:</p> <pre><code>es-translator --max-content-length 10M ...\n</code></pre> <p>Reduce worker count:</p> <pre><code>es-translator --pool-size 1 ...\n</code></pre> <p>Use Apertium (lower memory usage):</p> <pre><code>es-translator --interpreter apertium ...\n</code></pre>"},{"location":"troubleshooting/#high-elasticsearch-load","title":"High Elasticsearch Load","text":"<p>Add throttling:</p> <pre><code>es-translator --throttle 100 ...  # 100ms delay\n</code></pre> <p>Reduce pool size:</p> <pre><code>es-translator --pool-size 1 ...\n</code></pre>"},{"location":"troubleshooting/#distributed-mode-issues","title":"Distributed Mode Issues","text":""},{"location":"troubleshooting/#workers-not-processing","title":"Workers Not Processing","text":"<p>Check Redis connectivity:</p> <pre><code>redis-cli -h redis ping\n</code></pre> <p>Verify broker URL matches:</p> <pre><code># Planning\nes-translator --broker-url \"redis://redis:6379\" --plan ...\n\n# Workers (must use same URL)\nes-translator-tasks --broker-url \"redis://redis:6379\"\n</code></pre> <p>Check worker logs:</p> <pre><code>es-translator-tasks --broker-url \"redis://...\" --stdout-loglevel DEBUG\n</code></pre>"},{"location":"troubleshooting/#tasks-stuck-in-queue","title":"Tasks Stuck in Queue","text":"<p>Check Celery status:</p> <pre><code># If using Docker\ndocker logs es-translator-worker\n</code></pre> <p>Restart workers:</p> <pre><code>docker restart es-translator-worker\n</code></pre>"},{"location":"troubleshooting/#docker-issues","title":"Docker Issues","text":""},{"location":"troubleshooting/#container-exits-immediately","title":"Container Exits Immediately","text":"<p>Check logs:</p> <pre><code>docker logs &lt;container-id&gt;\n</code></pre> <p>Common causes:</p> <ul> <li>Missing required arguments (<code>--source-language</code>, <code>--target-language</code>)</li> <li>Invalid Elasticsearch URL</li> <li>Network connectivity issues</li> </ul>"},{"location":"troubleshooting/#permission-denied","title":"Permission Denied","text":"<p>For data directory access:</p> <pre><code>docker run -v /path/to/data:/data:rw icij/es-translator \\\n  es-translator --data-dir /data ...\n</code></pre>"},{"location":"troubleshooting/#debug-mode","title":"Debug Mode","text":"<p>Enable detailed logging to diagnose issues:</p> <pre><code>es-translator \\\n  --stdout-loglevel DEBUG \\\n  --dry-run \\\n  ...\n</code></pre>"},{"location":"troubleshooting/#dry-run","title":"Dry Run","text":"<p>Test configuration without modifying data:</p> <pre><code>es-translator --dry-run ...\n</code></pre>"},{"location":"troubleshooting/#getting-help","title":"Getting Help","text":"<p>If you're still stuck:</p> <ol> <li>Check GitHub Issues</li> <li>Open a new issue with:<ul> <li>es-translator version</li> <li>Command you ran</li> <li>Full error message</li> <li>Elasticsearch version</li> </ul> </li> </ol>"},{"location":"usage/","title":"Usage","text":"<p>This guide covers how to use es-translator to translate documents in Elasticsearch.</p>"},{"location":"usage/#quick-start","title":"Quick Start","text":"<p>Translate documents from French to English:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language fr \\\n  --target-language en\n</code></pre>"},{"location":"usage/#installation","title":"Installation","text":"pipDockerFrom source <pre><code>pip install es-translator\n</code></pre> <pre><code>docker run -it icij/es-translator es-translator --help\n</code></pre> <pre><code>git clone https://github.com/icij/es-translator.git\ncd es-translator\nmake install\n</code></pre>"},{"location":"usage/#optional-install-apertium","title":"Optional: Install Apertium","text":"<p>Apertium is only required if you want to use the Apertium interpreter. es-translator works out of the box with Argos (the default).</p> <pre><code>wget https://apertium.projectjj.com/apt/install-nightly.sh -O - | sudo bash\nsudo apt install apertium-all-dev\n</code></pre>"},{"location":"usage/#basic-translation","title":"Basic Translation","text":""},{"location":"usage/#translate-a-field","title":"Translate a Field","text":"<p>By default, es-translator translates the <code>content</code> field and stores results in <code>content_translated</code>:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language fr \\\n  --target-language en\n</code></pre>"},{"location":"usage/#translate-a-different-field","title":"Translate a Different Field","text":"<p>To translate a different field (e.g., <code>title</code>):</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language fr \\\n  --target-language en \\\n  --source-field title \\\n  --target-field title_translated\n</code></pre>"},{"location":"usage/#filter-documents","title":"Filter Documents","text":"<p>Use Elasticsearch query strings to filter which documents to translate:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language fr \\\n  --target-language en \\\n  --query-string \"type:article AND status:published\"\n</code></pre>"},{"location":"usage/#force-re-translation","title":"Force Re-translation","text":"<p>By default, es-translator skips already translated documents. To re-translate:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language fr \\\n  --target-language en \\\n  --force\n</code></pre>"},{"location":"usage/#choosing-an-interpreter","title":"Choosing an Interpreter","text":"<p>es-translator supports two translation backends:</p> Feature Argos (default) Apertium Type Neural Machine Translation Rule-based Translation Quality Higher quality Good for related languages Speed Slower (ML models) Faster Offline Yes (downloads models) Yes (system packages) Languages ~30 languages 40+ language pairs Intermediary Not supported Supported Installation Automatic Requires system packages"},{"location":"usage/#using-argos-default","title":"Using Argos (Default)","text":"<p>Argos provides neural machine translation with automatic model downloading:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language fr \\\n  --target-language en \\\n  --interpreter argos\n</code></pre>"},{"location":"usage/#using-apertium","title":"Using Apertium","text":"<p>Apertium provides rule-based translation, ideal for related languages:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language es \\\n  --target-language pt \\\n  --interpreter apertium\n</code></pre>"},{"location":"usage/#intermediary-languages","title":"Intermediary Languages","text":"<p>When a direct translation pair isn't available, use an intermediary language:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language pt \\\n  --target-language en \\\n  --interpreter apertium \\\n  --intermediary-language es\n</code></pre>"},{"location":"usage/#list-available-pairs","title":"List Available Pairs","text":"<pre><code># Show remotely available pairs\nes-translator-pairs\n\n# Show locally installed pairs\nes-translator-pairs --local\n</code></pre>"},{"location":"usage/#performance-tuning","title":"Performance Tuning","text":""},{"location":"usage/#parallel-processing","title":"Parallel Processing","text":"<p>Use multiple worker processes for faster translation:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language fr \\\n  --target-language en \\\n  --pool-size 4\n</code></pre>"},{"location":"usage/#large-datasets","title":"Large Datasets","text":"<p>For large datasets, increase the scroll timeout to prevent context loss:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language fr \\\n  --target-language en \\\n  --scan-scroll 30m\n</code></pre>"},{"location":"usage/#limit-content-length","title":"Limit Content Length","text":"<p>Prevent issues with very large documents:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language fr \\\n  --target-language en \\\n  --max-content-length 10M\n</code></pre>"},{"location":"usage/#throttling","title":"Throttling","text":"<p>Add delay between translations to reduce Elasticsearch load:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language fr \\\n  --target-language en \\\n  --throttle 100  # 100ms delay\n</code></pre>"},{"location":"usage/#gpu-acceleration","title":"GPU Acceleration","text":"<p>Argos supports GPU acceleration via CUDA for faster neural translation:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language fr \\\n  --target-language en \\\n  --device cuda\n</code></pre> <p>Available device options:</p> Device Description <code>auto</code> Use CUDA if available, otherwise CPU (default) <code>cuda</code> Force GPU usage (requires CUDA) <code>cpu</code> Force CPU usage <p>You can also set the device via environment variable:</p> <pre><code>export ES_TRANSLATOR_DEVICE=cuda\nes-translator ...\n</code></pre> <p>CUDA Requirements</p> <p>GPU acceleration requires a CUDA-compatible GPU and the appropriate CUDA libraries installed. If CUDA is not available and <code>--device cuda</code> is specified, translation will fail. See Install NVIDIA drivers on Ubuntu AWS instances for setup instructions.</p>"},{"location":"usage/#distributed-translation","title":"Distributed Translation","text":"<p>For very large datasets, distribute translation across multiple servers using Celery and Redis.</p>"},{"location":"usage/#step-1-plan-the-translation","title":"Step 1: Plan the Translation","text":"<p>Queue documents for translation:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language fr \\\n  --target-language en \\\n  --broker-url \"redis://redis:6379\" \\\n  --plan\n</code></pre>"},{"location":"usage/#step-2-start-workers","title":"Step 2: Start Workers","text":"<p>Start one or more workers to process the queue:</p> <pre><code>es-translator-tasks \\\n  --broker-url \"redis://redis:6379\" \\\n  --concurrency 2\n</code></pre>"},{"location":"usage/#using-docker-for-workers","title":"Using Docker for Workers","text":"<p>Run workers as a service with automatic restart:</p> <pre><code>docker run \\\n  --detach \\\n  --restart on-failure \\\n  --name es-translator-worker \\\n  icij/es-translator es-translator-tasks \\\n    --broker-url \"redis://redis:6379\" \\\n    --concurrency 2\n</code></pre>"},{"location":"usage/#step-3-monitor-progress","title":"Step 3: Monitor Progress","text":"<p>Use the live monitoring interface to track translation progress:</p> <pre><code>es-translator-monitor --broker-url \"redis://redis:6379\"\n</code></pre> <p>The monitor displays:</p> <ul> <li>Queue Status: Pending, active, and completed tasks</li> <li>Progress: Completion percentage, remaining tasks, and ETA</li> <li>Workers: Connected workers with per-worker throughput (tasks/sec)</li> <li>Throughput: Real-time graph of translation speed over time</li> </ul>"},{"location":"usage/#testing-debugging","title":"Testing &amp; Debugging","text":""},{"location":"usage/#dry-run","title":"Dry Run","text":"<p>Test without saving to Elasticsearch:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language fr \\\n  --target-language en \\\n  --dry-run\n</code></pre>"},{"location":"usage/#debug-logging","title":"Debug Logging","text":"<p>Enable verbose logging:</p> <pre><code>es-translator \\\n  --url \"http://localhost:9200\" \\\n  --index my-index \\\n  --source-language fr \\\n  --target-language en \\\n  --stdout-loglevel DEBUG\n</code></pre>"},{"location":"usage/#cli-reference","title":"CLI Reference","text":""},{"location":"usage/#es-translator","title":"es-translator","text":"<p>Main command for translating documents.</p> <pre><code>es-translator [OPTIONS]\n\nOptions:\n  -u, --url TEXT                  Elasticsearch URL\n  -i, --index TEXT                Elasticsearch Index\n  -r, --interpreter TEXT          Interpreter (argos or apertium)\n  -s, --source-language TEXT      Source language [required]\n  -t, --target-language TEXT      Target language [required]\n  --intermediary-language TEXT    Intermediary language for indirect translation\n  --source-field TEXT             Field to translate (default: content)\n  --target-field TEXT             Field for translations (default: content_translated)\n  -q, --query-string TEXT         Filter documents with query string\n  -d, --data-dir PATH             Directory for language models\n  --scan-scroll TEXT              Scroll duration (default: 5m)\n  --dry-run                       Don't save to Elasticsearch\n  -f, --force                     Re-translate existing translations\n  --pool-size INTEGER             Number of parallel workers\n  --pool-timeout INTEGER          Worker timeout in seconds\n  --throttle INTEGER              Delay between translations (ms)\n  --progressbar / --no-progressbar  Show progress bar\n  --plan                          Queue for distributed translation\n  --broker-url TEXT               Redis URL for distributed mode\n  --max-content-length TEXT       Max content length (e.g., 10M, 1G)\n  --device [cpu|cuda|auto]        Device for Argos translation (default: auto)\n  --stdout-loglevel TEXT          Log level (DEBUG, INFO, WARNING, ERROR)\n  --help                          Show help\n</code></pre>"},{"location":"usage/#es-translator-tasks","title":"es-translator-tasks","text":"<p>Start Celery workers for distributed translation.</p> <pre><code>es-translator-tasks [OPTIONS]\n\nOptions:\n  --broker-url TEXT       Redis URL\n  --concurrency INTEGER   Number of concurrent workers\n  --stdout-loglevel TEXT  Log level\n  --help                  Show help\n</code></pre>"},{"location":"usage/#es-translator-pairs","title":"es-translator-pairs","text":"<p>List available Apertium language pairs.</p> <pre><code>es-translator-pairs [OPTIONS]\n\nOptions:\n  --data-dir PATH   Directory for language packs\n  --local           Show only locally installed pairs\n  --help            Show help\n</code></pre>"},{"location":"usage/#es-translator-monitor","title":"es-translator-monitor","text":"<p>Live monitoring interface for distributed translation workers.</p> <pre><code>es-translator-monitor [OPTIONS]\n\nOptions:\n  --broker-url TEXT                     Redis URL (default: redis://localhost:6379)\n  --refresh FLOAT                       Refresh interval in seconds (default: 2.0)\n  --history FLOAT                       Throughput history duration in seconds (default: 60.0)\n  --chart-scale [s|min|h]               Throughput scale for chart (default: s)\n  --worker-scale [s|min|h]              Throughput scale for workers table (default: min)\n  --worker-throughput-lifespan FLOAT    Duration to average per-worker throughput (default: 30.0)\n  --help                                Show help\n</code></pre>"},{"location":"usage/#throughput-scale-options","title":"Throughput Scale Options","text":"<p>The <code>--chart-scale</code> and <code>--worker-scale</code> options control how throughput is displayed:</p> Scale Description Example <code>s</code> Tasks per second 2.5 tasks/s <code>min</code> Tasks per minute 150.0 tasks/min <code>h</code> Tasks per hour 9000.0 tasks/h <p>Example: Show tasks/second in the chart, tasks/minute in the workers table:</p> <pre><code>es-translator-monitor --chart-scale s --worker-scale min\n</code></pre>"},{"location":"usage/#worker-throughput-smoothing","title":"Worker Throughput Smoothing","text":"<p>The <code>--worker-throughput-lifespan</code> option controls how per-worker throughput is calculated. Instead of showing instantaneous rates (which can be noisy), it averages the throughput over the specified duration.</p> <ul> <li>Default: 30 seconds</li> <li>Higher values = smoother, more stable readings</li> <li>Lower values = more responsive to changes</li> </ul> <p>Example: Use a 60-second window for smoother per-worker throughput:</p> <pre><code>es-translator-monitor --worker-throughput-lifespan 60\n</code></pre>"}]}